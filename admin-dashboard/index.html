<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - agutidesigns</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f7f7f7;
        }

        /* ===== LOGIN PAGE ===== */
        .login-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: #f7f7f7;
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo p {
            color: #666;
            font-size: 0.9rem;
        }

        .login-box {
            background: white;
            max-width: 450px;
            width: 100%;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        }

        .login-header {
            background: #0046FE;
            margin: -40px -40px 30px -40px;
            padding: 30px 40px;
            border-radius: 20px 20px 0 0;
            text-align: center;
            color: white;
        }

        .login-header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .login-header p {
            opacity: 0.95;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 14px;
            border: 1px solid #e8eaed;
            border-radius: 10px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
            background: #fafbfc;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #0046FE;
            background: white;
            box-shadow: 0 0 0 3px rgba(0, 70, 254, 0.1);
        }

        .btn-login {
            width: 100%;
            padding: 16px;
            background: #0046FE;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-login:hover {
            background: #0036C8;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 70, 254, 0.25);
        }

        .error-message {
            background: #fee;
            color: #c00;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            display: none;
        }

        /* ===== DASHBOARD LAYOUT ===== */
        .dashboard {
            display: none;
            min-height: 100vh;
        }

        .dashboard-layout {
            display: flex;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 260px;
            background: white;
            border-right: 1px solid #e8eaed;
            min-height: 100vh;
            padding: 20px 0;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 1000;
        }

        .sidebar-logo {
            padding: 0 20px 30px;
            border-bottom: 1px solid #e8eaed;
            text-align: center;
        }

        .sidebar-logo img {
            height: 45px;
            margin-bottom: 12px;
        }

        .sidebar-logo p {
            color: #666;
            font-size: 0.85rem;
            margin: 0;
        }

        .sidebar-nav {
            margin-top: 20px;
        }

        .nav-item {
            padding: 14px 20px;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            font-weight: 500;
            margin: 5px 15px;
            border-radius: 10px;
        }

        .nav-item:hover {
            background: #f5f5f5;
            color: #0046FE;
        }

        .nav-item.active {
            background: #e8f4ff;
            color: #0046FE;
            font-weight: 600;
        }

        .nav-item .icon {
            font-size: 1.3rem;
            width: 24px;
            text-align: center;
        }

        .sidebar-footer {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            padding: 0 20px;
        }

        .btn-logout {
            width: 100%;
            padding: 12px;
            background: #f0f0f0;
            color: #333;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-logout:hover {
            background: #e0e0e0;
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            margin-left: 260px;
            flex: 1;
            padding: 30px;
            min-height: 100vh;
        }

        .content-header {
            margin-bottom: 30px;
        }

        .content-header h1 {
            color: #1B1B1B;
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .content-header p {
            color: #666;
            font-size: 0.95rem;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* ===== STATS GRID ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #0046FE 0%, #0036C8 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20px;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .stat-card.green {
            background: linear-gradient(135deg, #009A62 0%, #007A4F 100%);
        }

        .stat-card.yellow {
            background: linear-gradient(135deg, #E5FC63 0%, #D4EB52 100%);
            color: #1B1B1B;
        }

        .stat-card.red {
            background: linear-gradient(135deg, #EC6746 0%, #D85635 100%);
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-change {
            font-size: 0.85rem;
            opacity: 0.85;
            margin-top: 8px;
        }

        /* ===== CARDS ===== */
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #e8eaed;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e8eaed;
        }

        .card-header h2 {
            color: #1B1B1B;
            font-size: 1.3rem;
        }

        .btn-primary {
            background: #0046FE;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: #0036C8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-danger {
            background: #EC6746;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-success {
            background: #009A62;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        /* ===== TABLE ===== */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f8f9fa;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #666;
            border-bottom: 2px solid #e0e0e0;
            font-size: 0.9rem;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        tr:hover {
            background: #f8f9fa;
        }

        /* ===== BADGES ===== */
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .badge-blue {
            background: #e7f1ff;
            color: #0046FE;
        }

        /* ===== KANBAN BOARD ===== */
        .kanban-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .kanban-column {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            min-height: 400px;
        }

        .kanban-header {
            font-weight: 700;
            color: #1B1B1B;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .kanban-count {
            background: #0046FE;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
        }

        .kanban-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: move;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .kanban-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .kanban-card-title {
            font-weight: 700;
            color: #1B1B1B;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .kanban-card-info {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 5px;
        }

        .kanban-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #f0f0f0;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0046FE, #009A62);
            transition: width 0.3s ease;
        }

        /* ===== MODAL ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #1B1B1B;
            font-size: 1.5rem;
        }

        .btn-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        /* ===== LOADER ===== */
        .loader {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #0046FE;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ===== VIDEO GRID ===== */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .video-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .video-card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            transform: translateY(-4px);
        }

        .video-thumbnail {
            width: 100%;
            height: 180px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #999;
        }

        .video-info {
            padding: 15px;
        }

        .video-title {
            font-weight: 700;
            color: #1B1B1B;
            margin-bottom: 8px;
        }

        .video-meta {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 12px;
        }

        .video-actions {
            display: flex;
            gap: 8px;
        }

        /* ===== WEBS DESPLEGADAS GRID (ManageWP Style) ===== */
        .webs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .web-card {
            background: white;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
                flex-direction: column;
                gap: 15px;
        }

        .web-card:hover {
            box-shadow: 0 6px 20px rgba(0,70,254,0.12);
            border-color: #0046FE;
            transform: translateY(-2px);
        }

        .web-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 10px;
        }

        .web-domain {
            flex: 1;
            min-width: 0;
        }

        .web-domain h3 {
            font-size: 1.1rem;
            color: #1B1B1B;
            margin: 0 0 5px 0;
            font-weight: 700;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .web-url {
            font-size: 0.85rem;
            color: #0046FE;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .web-url:hover {
            text-decoration: underline;
        }

        .web-status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .web-status-activo {
            background: #d4edda;
            color: #155724;
        }

        .web-status-inactivo {
            background: #fff3cd;
            color: #856404;
        }

        .web-status-mantenimiento {
            background: #cce5ff;
            color: #004085;
        }

        .web-card-info {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 15px 0;
            border-top: 1px solid #e0e0e0;
            border-bottom: 1px solid #e0e0e0;
        }

        .web-info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
                font-size: 0.9rem;
            }

        .web-info-label {
            color: #666;
            font-weight: 500;
        }

        .web-info-value {
            color: #1B1B1B;
            font-weight: 600;
        }

        .web-plan-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .plan-basico {
            background: #e3f2fd;
            color: #1976d2;
        }

        .plan-avanzado {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .plan-premium {
            background: #fff3e0;
            color: #e65100;
        }

        .web-card-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-web-action {
            flex: 1;
            min-width: 100px;
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .btn-web-visit {
            background: #0046FE;
            color: white;
        }

        .btn-web-visit:hover {
            background: #0036C8;
        }

        .btn-web-manage {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e0e0e0;
        }

        .btn-web-manage:hover {
            background: #e9ecef;
            border-color: #999;
        }

        .btn-web-details {
            background: #6c757d;
            color: white;
        }

        .btn-web-details:hover {
            background: #5a6268;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1024px) {
            .kanban-board {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .main-content {
                margin-left: 0;
            }

            .kanban-board {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ===== LOGIN PAGE ===== -->
    <div class="login-container" id="loginPage">
        <div class="login-box">
            <div class="login-header">
            <h1>üîí Admin Login</h1>
            <p>Dashboard de agutidesigns</p>
            </div>
            <div class="error-message" id="errorMessage">Usuario o contrase√±a incorrectos</div>
            <form id="loginForm">
                <div class="form-group">
                    <label>Usuario</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label>Contrase√±a</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn-login">Iniciar Sesi√≥n</button>
            </form>
        </div>
    </div>

    <!-- ===== DASHBOARD ===== -->
    <div class="dashboard" id="dashboard">
        <div class="dashboard-layout">
            <!-- SIDEBAR -->
            <div class="sidebar">
                <div class="sidebar-logo">
                    <img src="/images/Logo.svg" alt="agutidesigns">
                    <p>Panel de Administraci√≥n</p>
                </div>
                
                <div class="sidebar-nav">
                    <div class="nav-item active" onclick="showSection('estadisticas')">
                        <span class="icon">üìä</span>
                        <span>Estad√≠sticas</span>
                    </div>
                    <div class="nav-item" onclick="showSection('webs')">
                        <span class="icon">üåê</span>
                        <span>Webs (Kanban)</span>
                    </div>
                    <div class="nav-item" onclick="showSection('tickets')">
                        <span class="icon">üé´</span>
                        <span>Tickets</span>
                        <span id="unreadBadgeMenuAdmin" style="display: none; background: #0046FE; color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: 700; margin-left: auto;"></span>
                    </div>
                    <div class="nav-item" onclick="showSection('pedidos')">
                        <span class="icon">üìã</span>
                        <span>Pedidos</span>
                    </div>
                    <div class="nav-item" onclick="showSection('clientes')">
                        <span class="icon">üë•</span>
                        <span>Clientes</span>
                    </div>
                    <div class="nav-item" onclick="showSection('videos')">
                        <span class="icon">üé•</span>
                        <span>Videos</span>
                    </div>
                    <div class="nav-item" onclick="showSection('webs-desplegadas')">
                        <span class="icon">üöÄ</span>
                        <span>Webs Desplegadas</span>
                    </div>
                    <div class="nav-item" onclick="showSection('facturas')">
                        <span class="icon">üßæ</span>
                        <span>Facturas</span>
                    </div>
                </div>

                <div class="sidebar-footer">
            <button class="btn-logout" onclick="logout()">Cerrar Sesi√≥n</button>
                </div>
        </div>

            <!-- MAIN CONTENT -->
            <div class="main-content">
                <!-- SECCI√ìN: ESTAD√çSTICAS -->
                <div class="section active" id="section-estadisticas">
                    <div class="content-header">
                        <h1>üìä Estad√≠sticas</h1>
                        <p>Vista general del negocio</p>
                    </div>

            <div class="stats-grid">
                <div class="stat-card blue">
                            <div class="stat-label">
                                <span>üìù</span>
                                Total Solicitudes
                            </div>
                    <div class="stat-value" id="totalSubmissions">0</div>
                            <div class="stat-change">+12% este mes</div>
                </div>
                <div class="stat-card green">
                            <div class="stat-label">
                                <span>‚úÖ</span>
                                Clientes Activos
                            </div>
                            <div class="stat-value" id="activeClients">0</div>
                            <div class="stat-change">Clientes con plan</div>
                </div>
                <div class="stat-card yellow">
                            <div class="stat-label">
                                <span>‚è≥</span>
                                Sin Plan
                            </div>
                            <div class="stat-value" id="inactiveClients">0</div>
                            <div class="stat-change">Oportunidades de venta</div>
                </div>
                <div class="stat-card green">
                            <div class="stat-label">
                                <span>üí∞</span>
                                Ingresos Totales
                            </div>
                    <div class="stat-value" id="totalRevenue">0‚Ç¨</div>
                            <div class="stat-change">Revenue acumulado</div>
                        </div>
                        <div class="stat-card blue">
                            <div class="stat-label">
                                <span>üé´</span>
                                Tickets Abiertos
                            </div>
                            <div class="stat-value" id="openTickets">0</div>
                            <div class="stat-change">Requieren atenci√≥n</div>
                        </div>
                        <div class="stat-card red">
                            <div class="stat-label">
                                <span>üåê</span>
                                Webs en Desarrollo
                            </div>
                            <div class="stat-value" id="websInProgress">0</div>
                            <div class="stat-change">Proyectos activos</div>
                </div>
            </div>

                    <div class="card">
                        <div class="card-header">
                            <h2>üìà Distribuci√≥n de Planes</h2>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">Plan B√°sico</div>
                                <div class="stat-value" id="planBasico">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Plan Avanzado</div>
                                <div class="stat-value" id="planAvanzado">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Plan Premium</div>
                                <div class="stat-value" id="planPremium">0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECCI√ìN: WEBS (KANBAN) -->
                <div class="section" id="section-webs">
                    <div class="content-header">
                        <h1>üåê Gesti√≥n de Webs</h1>
                        <p>Vista Kanban de todos los proyectos</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2>Proyectos</h2>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <button class="btn-primary" onclick="loadProjects()" style="font-size: 0.9rem;">üîÑ Recargar Proyectos</button>
                                <span style="color: #666; font-size: 0.85rem;">Los proyectos se crean autom√°ticamente al completar el pago</span>
                            </div>
                        </div>
                        
                        <div class="kanban-board">
                            <div class="kanban-column">
                                <div class="kanban-header">
                                    <span>üî¥ Sin Empezar</span>
                                    <span class="kanban-count" id="count-sin-empezar">0</span>
                                </div>
                                <div id="kanban-sin-empezar"></div>
                            </div>
                            <div class="kanban-column">
                                <div class="kanban-header">
                                    <span>üü° En Desarrollo</span>
                                    <span class="kanban-count" id="count-desarrollo">0</span>
                                </div>
                                <div id="kanban-desarrollo"></div>
                            </div>
                            <div class="kanban-column">
                                <div class="kanban-header">
                                    <span>üü† En Revisi√≥n</span>
                                    <span class="kanban-count" id="count-revision">0</span>
                                </div>
                                <div id="kanban-revision"></div>
                            </div>
                            <div class="kanban-column">
                                <div class="kanban-header">
                                    <span>üü¢ Entregada</span>
                                    <span class="kanban-count" id="count-entregada">0</span>
                                </div>
                                <div id="kanban-entregada"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECCI√ìN: TICKETS -->
                <div class="section" id="section-tickets">
                    <div class="content-header">
                        <h1>üé´ Sistema de Tickets</h1>
                        <p>Gestiona las solicitudes de soporte</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2>Tickets Recientes</h2>
                            <button class="btn-primary" onclick="loadTickets()">üîÑ Actualizar</button>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Cliente</th>
                                        <th>Asunto</th>
                                        <th>Categor√≠a</th>
                                        <th>Prioridad</th>
                                        <th>Estado</th>
                                        <th>Fecha</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="ticketsTable">
                                    <tr>
                                        <td colspan="8">
                                            <div class="loader">
                                                <div class="spinner"></div>
                                                <p>Cargando tickets...</p>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- SECCI√ìN: PEDIDOS -->
                <div class="section" id="section-pedidos">
                    <div class="content-header">
                        <h1>üìã Pedidos</h1>
                        <p>Todas las solicitudes de membres√≠a</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2>Lista de Pedidos</h2>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn-primary" onclick="loadPedidos()">üîÑ Actualizar</button>
                            </div>
                        </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Empresa</th>
                                <th>Email</th>
                                <th>Plan</th>
                                <th>Monto</th>
                                <th>Estado</th>
                                <th>Fecha</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                                <tbody id="pedidosTable">
                            <tr>
                                <td colspan="8">
                                    <div class="loader">
                                        <div class="spinner"></div>
                                                <p>Cargando pedidos...</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
                </div>

                <!-- SECCI√ìN: CLIENTES -->
                <div class="section" id="section-clientes">
                    <div class="content-header">
                        <h1>üë• Gesti√≥n de Clientes</h1>
                        <p>Todos los usuarios registrados</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2>Lista de Clientes</h2>
                            <button class="btn-primary" onclick="loadClientes()">üîÑ Actualizar</button>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre</th>
                                        <th>Email</th>
                                        <th>Empresa</th>
                                        <th>Plan</th>
                                        <th>Estado</th>
                                        <th>Registro</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="clientesTable">
                                    <tr>
                                        <td colspan="8">
                                            <div class="loader">
                                                <div class="spinner"></div>
                                                <p>Cargando clientes...</p>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- SECCI√ìN: VIDEOS -->
                <div class="section" id="section-videos">
                    <div class="content-header">
                        <h1>üé• Videos Formativos</h1>
                        <p>Gestiona los tutoriales para clientes</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2>Biblioteca de Videos</h2>
                            <button class="btn-primary" onclick="openNewVideoModal()">+ A√±adir Video</button>
                        </div>
                        <div class="video-grid" id="videosGrid">
                            <div class="loader">
                                <div class="spinner"></div>
                                <p>Cargando videos...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECCI√ìN: WEBS DESPLEGADAS (ManageWP Style) -->
                <div class="section" id="section-webs-desplegadas">
                    <div class="content-header">
                        <h1>üöÄ Webs Desplegadas</h1>
                        <p>Gestiona todos los sitios web en producci√≥n</p>
                    </div>

                    <!-- Filtros y B√∫squeda -->
                    <div class="card" style="margin-bottom: 20px;">
                        <div style="padding: 20px; display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                            <!-- B√∫squeda -->
                            <div style="flex: 1; min-width: 250px;">
                                <input type="text" id="searchWebsInput" placeholder="üîç Buscar por dominio, cliente o empresa..." style="width: 100%; padding: 10px 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem;">
                            </div>
                            
                            <!-- Filtro Estado -->
                            <div>
                                <select id="filterStatusWebs" style="padding: 10px 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem; min-width: 150px;">
                                    <option value="">Todos los estados</option>
                                    <option value="activo">‚úÖ Activo</option>
                                    <option value="inactivo">‚ö†Ô∏è Inactivo</option>
                                    <option value="mantenimiento">üîß Mantenimiento</option>
                                </select>
                            </div>
                            
                            <!-- Filtro Plan -->
                            <div>
                                <select id="filterPlanWebs" style="padding: 10px 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem; min-width: 150px;">
                                    <option value="">Todos los planes</option>
                                    <option value="basico">Plan B√°sico</option>
                                    <option value="avanzado">Plan Avanzado</option>
                                    <option value="premium">Plan Premium</option>
                                </select>
                            </div>
                            
                            <!-- Bot√≥n Reset -->
                            <button onclick="resetWebsFilters()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                üîÑ Limpiar
                            </button>
                            
                            <!-- Contador -->
                            <div style="margin-left: auto; padding: 10px 20px; background: #f8f9fa; border-radius: 8px; font-weight: 600; color: #333;">
                                <span id="websCounter">0</span> sitios
                            </div>
                        </div>
                    </div>

                    <!-- Grid de Sitios Web -->
                    <div class="webs-grid" id="websGrid">
                        <div class="loader">
                            <div class="spinner"></div>
                            <p>Cargando sitios web...</p>
                        </div>
                    </div>
                </div>

                <!-- SECCI√ìN: FACTURAS -->
                <div class="section" id="section-facturas">
                    <div class="content-header">
                        <h1>üßæ Facturas</h1>
                        <p>Gestiona todas las facturas de Stripe</p>
                    </div>

                    <!-- Filtros de Tiempo -->
                    <div class="card" style="margin-bottom: 20px;">
                        <div style="padding: 20px;">
                            <h3 style="margin-bottom: 15px; font-size: 1rem; color: #333;">üìÖ Filtrar por Per√≠odo</h3>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button class="btn-filter" data-period="week" onclick="filterInvoicesByPeriod('week')" style="padding: 10px 20px; border: 2px solid #0046FE; background: #0046FE; color: white; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                                    üìÖ √öltima Semana
                                </button>
                                <button class="btn-filter" data-period="month" onclick="filterInvoicesByPeriod('month')" style="padding: 10px 20px; border: 2px solid #e0e0e0; background: white; color: #333; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                                    üìÜ √öltimo Mes
                                </button>
                                <button class="btn-filter" data-period="quarter" onclick="filterInvoicesByPeriod('quarter')" style="padding: 10px 20px; border: 2px solid #e0e0e0; background: white; color: #333; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                                    üìä √öltimo Trimestre
                                </button>
                                <button class="btn-filter" data-period="year" onclick="filterInvoicesByPeriod('year')" style="padding: 10px 20px; border: 2px solid #e0e0e0; background: white; color: #333; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                                    üìà √öltimo A√±o
                                </button>
                                <button class="btn-filter" data-period="all" onclick="filterInvoicesByPeriod('all')" style="padding: 10px 20px; border: 2px solid #e0e0e0; background: white; color: #333; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                                    üåê Todas
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Estad√≠sticas -->
                    <div class="dashboard-stats" style="margin-bottom: 20px;">
                        <div class="stat-card">
                            <div class="stat-value" id="totalInvoices">0</div>
                            <div class="stat-label">Total Facturas</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="paidInvoices" style="color: #10B981;">0</div>
                            <div class="stat-label">Pagadas</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="pendingInvoices" style="color: #F59E0B;">0</div>
                            <div class="stat-label">Pendientes</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalRevenue" style="color: #0046FE;">0‚Ç¨</div>
                            <div class="stat-label">Ingresos Totales</div>
                        </div>
                    </div>

                    <!-- Tabla de Facturas -->
                    <div class="card">
                        <div class="card-header">
                            <h2>Lista de Facturas</h2>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn-primary" onclick="loadAllInvoices()">üîÑ Actualizar</button>
                                <button class="btn-secondary" onclick="exportInvoices()">üì• Exportar CSV</button>
                            </div>
                        </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>N¬∫ Factura</th>
                                <th>Cliente</th>
                                <th>Empresa</th>
                                <th>Monto</th>
                                <th>Estado</th>
                                <th>Fecha</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="invoicesTable">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 40px;">
                                    <div class="loader">
                                        <div class="spinner"></div>
                                        <p>Cargando facturas...</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== MODALS ===== -->
    
    <!-- Modal: Ver/Responder Ticket -->
    <div class="modal" id="ticketModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üé´ Detalles del Ticket</h3>
                <button class="btn-close" onclick="closeTicketModal()">√ó</button>
            </div>
            <div id="ticketDetails"></div>
        </div>
    </div>

    <!-- Modal: Ver Detalles del Pedido -->
    <div class="modal" id="pedidoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìã Detalles del Pedido</h3>
                <button class="btn-close" onclick="closePedidoModal()">√ó</button>
            </div>
            <div id="pedidoDetails"></div>
        </div>
    </div>

    <!-- Modal: A√±adir Video -->
    <div class="modal" id="videoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üé• A√±adir Video</h3>
                <button class="btn-close" onclick="closeVideoModal()">√ó</button>
            </div>
            <form id="videoForm">
                <div class="form-group">
                    <label>T√≠tulo del Video</label>
                    <input type="text" id="videoTitle" required>
                </div>
                <div class="form-group">
                    <label>Descripci√≥n</label>
                    <textarea id="videoDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>URL del Video (YouTube/Vimeo)</label>
                    <input type="url" id="videoUrl" placeholder="https://www.youtube.com/watch?v=..." required>
                </div>
                <div class="form-group">
                    <label>Categor√≠a</label>
                    <select id="videoCategory">
                        <option value="tutorial_elementor">Tutorial Elementor</option>
                        <option value="seo">SEO</option>
                        <option value="marketing">Marketing</option>
                        <option value="basico">B√°sico</option>
                        <option value="avanzado">Avanzado</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Duraci√≥n (ej: 10:30)</label>
                    <input type="text" id="videoDuration" placeholder="10:30">
                </div>
                <button type="submit" class="btn-primary" style="width: 100%; margin-top: 10px;">Guardar Video</button>
            </form>
        </div>
    </div>

    <!-- Modal: Nuevo Proyecto -->
    <div class="modal" id="projectModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üåê Nuevo Proyecto</h3>
                <button class="btn-close" onclick="closeProjectModal()">√ó</button>
            </div>
            <form id="projectForm">
                <div class="form-group">
                    <label>Cliente</label>
                    <select id="projectClient" required>
                        <option value="">Selecciona un cliente...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Nombre del Proyecto</label>
                    <input type="text" id="projectName" required>
                </div>
                <div class="form-group">
                    <label>Estado</label>
                    <select id="projectStatus" disabled style="background-color: #f5f5f5; cursor: not-allowed;">
                        <option value="sin_empezar">Sin Empezar</option>
                        <option value="en_desarrollo">En Desarrollo</option>
                        <option value="revision">En Revisi√≥n</option>
                        <option value="entregada">Entregada</option>
                    </select>
                    <small style="color: #666; font-size: 0.85rem; margin-top: 5px; display: block;">El estado se cambia arrastrando el proyecto en el Kanban</small>
                </div>
                <div class="form-group">
                    <label>Prioridad</label>
                    <select id="projectPriority">
                        <option value="low">Baja</option>
                        <option value="normal">Normal</option>
                        <option value="high">Alta</option>
                        <option value="urgent">Urgente</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Deadline</label>
                    <input type="date" id="projectDeadline">
                </div>
                <div class="form-group">
                    <label>Progreso (%)</label>
                    <input type="number" id="projectProgress" min="0" max="100" value="0">
                </div>
                <div class="form-group">
                    <label>Notas</label>
                    <textarea id="projectNotes" rows="3"></textarea>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button type="submit" class="btn-primary" style="flex: 1;">Crear Proyecto</button>
                    <button type="button" id="deployWebButton" class="btn-secondary" style="flex: 1; background: #10B981; display: none;" onclick="deployWebFromProject()">
                        üöÄ Crear en Webs Desplegadas
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_URL = 'https://agutidesigns-production.up.railway.app';

        // ===== VERIFICAR SESI√ìN AL CARGAR =====
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üîê [ADMIN] Verificando sesi√≥n...');
            const adminSession = localStorage.getItem('adminSession');
            
            if (adminSession) {
                try {
                    const session = JSON.parse(adminSession);
                    console.log('‚úÖ [ADMIN] Sesi√≥n encontrada:', session.username);
                    
                    // Mostrar dashboard directamente
                    document.getElementById('loginPage').style.display = 'none';
                    document.getElementById('dashboard').style.display = 'block';
                    loadDashboard();
                } catch (error) {
                    console.error('‚ùå [ADMIN] Error parseando sesi√≥n:', error);
                    localStorage.removeItem('adminSession');
                }
            } else {
                console.log('‚ö†Ô∏è [ADMIN] No hay sesi√≥n, mostrando login');
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('dashboard').style.display = 'none';
            }
        });

        // ===== LOGIN =====
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            try {
                console.log('üîê [ADMIN] Intentando login...');
                const response = await fetch(`${API_URL}/api/admin/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log('‚úÖ [ADMIN] Login exitoso');
                    
                    // GUARDAR SESI√ìN EN LOCALSTORAGE
                    const adminSession = {
                        username: username,
                        loginTime: new Date().toISOString(),
                        isAdmin: true
                    };
                    localStorage.setItem('adminSession', JSON.stringify(adminSession));
                    console.log('üíæ [ADMIN] Sesi√≥n guardada en localStorage');
                    
                    // Mostrar dashboard
                    document.getElementById('loginPage').style.display = 'none';
                    document.getElementById('dashboard').style.display = 'block';
                    loadDashboard();
                } else {
                    console.error('‚ùå [ADMIN] Login fallido');
                    document.getElementById('errorMessage').style.display = 'block';
                }
            } catch (error) {
                console.error('‚ùå [ADMIN] Error de conexi√≥n:', error);
                showNotification('Error de conexi√≥n', 'error');
            }
        });

        // ===== LOGOUT =====
        function logout() {
            console.log('üîê [ADMIN] Cerrando sesi√≥n...');
            
            // ELIMINAR SESI√ìN DE LOCALSTORAGE
            localStorage.removeItem('adminSession');
            console.log('üíæ [ADMIN] Sesi√≥n eliminada de localStorage');
            
            // Mostrar login
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('loginForm').reset();
        }

        // ===== NAVEGACI√ìN =====
        function showSection(sectionName) {
            // Ocultar todas las secciones
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            // Mostrar secci√≥n seleccionada
            document.getElementById(`section-${sectionName}`).classList.add('active');
            event.target.closest('.nav-item').classList.add('active');
            
            // Cargar datos espec√≠ficos
            switch(sectionName) {
                case 'tickets':
                    loadTickets();
                    break;
                case 'pedidos':
                    loadPedidos();
                    break;
                case 'clientes':
                    loadClientes();
                    break;
                case 'videos':
                    loadVideos();
                    break;
                case 'webs':
                    loadProjects();
                    break;
                case 'webs-desplegadas':
                    loadWebsDesplegadas();
                    break;
                case 'facturas':
                    loadAllInvoices();
                    break;
            }
        }

        // ===== CARGAR DASHBOARD =====
        async function loadDashboard() {
            await loadStats();
            await loadProjects();
        }

        // ===== CARGAR ESTAD√çSTICAS =====
        async function loadStats() {
            try {
                console.log('üìä [ADMIN] Cargando estad√≠sticas...');
                const response = await fetch(`${API_URL}/api/admin/stats`);
                const stats = await response.json();

                console.log('üìä [ADMIN] Estad√≠sticas recibidas:', stats);

                // Actualizar estad√≠sticas principales
                document.getElementById('totalSubmissions').textContent = stats.total || 0;
                document.getElementById('activeClients').textContent = stats.activeClients || 0;
                document.getElementById('inactiveClients').textContent = stats.noPlan || 0;
                document.getElementById('totalRevenue').textContent = (stats.revenue || 0) + '‚Ç¨';
                
                // Webs en desarrollo
                const websEnDesarrollo = document.getElementById('websEnDesarrollo');
                if (websEnDesarrollo) {
                    websEnDesarrollo.textContent = stats.projectsInProgress || 0;
                }
                
                // Distribuci√≥n de planes (si existen)
                if (stats.byPlan) {
                    const planBasico = document.getElementById('planBasico');
                    const planAvanzado = document.getElementById('planAvanzado');
                    const planPremium = document.getElementById('planPremium');
                    
                    if (planBasico) planBasico.textContent = stats.byPlan.basico || 0;
                    if (planAvanzado) planAvanzado.textContent = stats.byPlan.avanzado || 0;
                    if (planPremium) planPremium.textContent = stats.byPlan.premium || 0;
                }
                
                console.log('‚úÖ [ADMIN] Estad√≠sticas cargadas correctamente');
            } catch (error) {
                console.error('‚ùå [ADMIN] Error cargando stats:', error);
            }
        }

        // ===== TICKETS =====
        async function loadTickets() {
            try {
                console.log('üé´ [ADMIN] Cargando tickets...');
                const response = await fetch(`${API_URL}/api/tickets`);
                const allTickets = await response.json();
                
                console.log('üé´ [ADMIN] Tickets recibidos:', allTickets.length, 'tickets');
                
                // FILTRAR: Excluir tickets autom√°ticos de cambios de plan (categor√≠a "facturacion")
                const tickets = allTickets.filter(ticket => ticket.category !== 'facturacion');
                
                console.log('üé´ [ADMIN] Tickets despu√©s de filtrar:', tickets.length, 'tickets');
                console.log('üé´ [ADMIN] Datos:', tickets);

                const tbody = document.getElementById('ticketsTable');
                
                if (tickets.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 40px;">No hay tickets</td></tr>';
                    console.log('‚úÖ [ADMIN] No hay tickets de soporte (se filtraron los tickets de facturaci√≥n)');
                    return;
                }

                tbody.innerHTML = tickets.map(ticket => {
                    // Determinar si hay mensaje sin leer del cliente
                    const hasUnreadMessage = ticket.admin_unread === 1;
                    const rowStyle = hasUnreadMessage ? 'background: #e8f4ff; font-weight: 600;' : '';
                    
                    // Badge de prioridad con colores correctos
                    const priorityColors = {
                        'alta': 'danger',
                        'media': 'warning',
                        'baja': 'info'
                    };
                    const priorityBadge = priorityColors[ticket.priority] || 'secondary';
                    
                    // Badge de estado con colores correctos
                    const statusColors = {
                        'abierto': 'warning',
                        'en_proceso': 'info',
                        'cerrado': 'success'
                    };
                    const statusBadge = statusColors[ticket.status] || 'secondary';
                    
                    return `
                        <tr style="${rowStyle}">
                            <td><strong>#${ticket.id}</strong> ${hasUnreadMessage ? '<span style="color: #0046FE; font-size: 1.2rem;">‚óè</span>' : ''}</td>
                            <td>${ticket.client_name || 'N/A'}</td>
                            <td>${ticket.subject}</td>
                            <td><span class="badge badge-info">${ticket.category}</span></td>
                            <td><span class="badge badge-${priorityBadge}">${ticket.priority}</span></td>
                            <td><span class="badge badge-${statusBadge}">${ticket.status}</span></td>
                            <td>${formatDate(ticket.created_at)}</td>
                            <td><button class="btn-secondary" onclick="viewTicket(${ticket.id})" ${hasUnreadMessage ? 'style="background: #0046FE; color: white; font-weight: 600;"' : ''}>Ver${hasUnreadMessage ? ' ‚óè' : ''}</button></td>
                        </tr>
                    `;
                }).join('');
                
                // Contar mensajes sin leer del admin
                const unreadCount = tickets.filter(t => t.admin_unread === 1).length;
                console.log('üîî [ADMIN] Mensajes sin leer:', unreadCount);
                
                // Actualizar badge en el men√∫
                const badge = document.getElementById('unreadBadgeMenuAdmin');
                if (badge) {
                    if (unreadCount > 0) {
                        badge.textContent = unreadCount;
                        badge.style.display = 'inline-block';
                    } else {
                        badge.style.display = 'none';
                    }
                }
                
                // Actualizar contador en stats
                const openCount = tickets.filter(t => t.status === 'open').length;
                document.getElementById('openTickets').textContent = openCount;
            } catch (error) {
                console.error('Error cargando tickets:', error);
            }
        }

        async function viewTicket(id) {
            try {
                console.log('üé´ [ADMIN] Cargando detalles del ticket #', id);
                // Marcar como le√≠do por el admin
                const response = await fetch(`${API_URL}/api/tickets/${id}?markAsRead=admin`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const ticket = await response.json();
                console.log('üé´ [ADMIN] Ticket recibido:', ticket);
                console.log('üîç [ADMIN] ¬øTiene admin_response?', ticket.admin_response ? 'S√ç' : 'NO');
                console.log('üîç [ADMIN] ¬øTiene client_response?', ticket.client_response ? 'S√ç' : 'NO');
                console.log('üîç [ADMIN] Valor de client_response:', ticket.client_response);
                
                const detailsDiv = document.getElementById('ticketDetails');
                
                // Badge colors
                const priorityColors = {
                    'alta': 'danger',
                    'media': 'warning',
                    'baja': 'info'
                };
                
                const statusColors = {
                    'abierto': 'warning',
                    'en_proceso': 'info',
                    'cerrado': 'success'
                };
                
                const statusText = {
                    'abierto': 'Abierto',
                    'en_proceso': 'En Proceso',
                    'cerrado': 'Cerrado'
                };
                
                detailsDiv.innerHTML = `
                    <div style="max-height: 70vh; overflow-y: auto; padding-right: 10px;">
                        <!-- Encabezado del Ticket -->
                        <div style="padding: 20px; background: linear-gradient(135deg, #0046FE 0%, #0036C8 100%); border-radius: 12px; color: white; margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                <div>
                                    <h3 style="margin: 0 0 5px 0; font-size: 1.3rem;">Ticket #${ticket.id}</h3>
                                    <p style="margin: 0; opacity: 0.9; font-size: 0.9rem;">${formatDate(ticket.created_at)}</p>
                                </div>
                                <div style="text-align: right;">
                                    <span class="badge badge-${priorityColors[ticket.priority]}" style="font-size: 0.9rem; padding: 6px 12px;">
                                        ${ticket.priority.toUpperCase()}
                                    </span>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                                <div>
                                    <p style="margin: 0; opacity: 0.9; font-size: 0.85rem;">Estado:</p>
                                    <p style="margin: 5px 0 0 0; font-size: 1rem; font-weight: 600;">${statusText[ticket.status] || ticket.status}</p>
                                </div>
                                <div>
                                    <p style="margin: 0; opacity: 0.9; font-size: 0.85rem;">Categor√≠a:</p>
                                    <p style="margin: 5px 0 0 0; font-size: 1rem; font-weight: 600;">${ticket.category}</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Informaci√≥n del Cliente -->
                        <div style="border: 2px solid #e0e0e0; border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                            <h4 style="color: #0046FE; margin: 0 0 12px 0; font-size: 1rem;">üë§ Cliente</h4>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 0.9rem;">
                                <p style="margin: 0;"><strong>Nombre:</strong> ${ticket.client_name || 'N/A'}</p>
                                <p style="margin: 0;"><strong>Email:</strong> <a href="mailto:${ticket.client_email}" style="color: #0046FE;">${ticket.client_email}</a></p>
                                ${ticket.business_name ? `<p style="margin: 0; grid-column: 1/-1;"><strong>Empresa:</strong> ${ticket.business_name}</p>` : ''}
                            </div>
                        </div>
                        
                        <!-- Asunto -->
                        <div style="border: 2px solid #e0e0e0; border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                            <h4 style="color: #0046FE; margin: 0 0 10px 0; font-size: 1rem;">üìå Asunto</h4>
                            <p style="margin: 0; font-size: 1rem; font-weight: 600;">${ticket.subject}</p>
                        </div>
                        
                        <!-- Descripci√≥n -->
                        <div style="border: 2px solid #e0e0e0; border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                            <h4 style="color: #0046FE; margin: 0 0 10px 0; font-size: 1rem;">üìù Descripci√≥n</h4>
                            <p style="margin: 0; font-size: 0.9rem; line-height: 1.6; white-space: pre-wrap;">${ticket.description}</p>
                        </div>
                        
                        ${ticket.admin_response ? `
                        <!-- Respuesta del Admin -->
                        <div style="border: 2px solid #28a745; background: #f0f9f4; border-radius: 10px; padding: 15px; margin-bottom: 15px;" data-admin-response>
                            <h4 style="color: #28a745; margin: 0 0 10px 0; font-size: 1rem;">üí¨ Tu Respuesta</h4>
                            <p style="margin: 0; font-size: 0.9rem; line-height: 1.6; white-space: pre-wrap;">${ticket.admin_response}</p>
                            ${ticket.admin_response_at ? `<p style="margin: 10px 0 0 0; font-size: 0.8rem; color: #666;">üìÖ Enviado: ${formatDate(ticket.admin_response_at)}</p>` : ''}
                        </div>
                        ` : ''}
                        
                        ${ticket.client_response ? `
                        <!-- Respuesta del Cliente -->
                        <div style="border: 2px solid #0046FE; background: #e8f4ff; border-radius: 10px; padding: 15px; margin-bottom: 15px;" data-client-response data-timestamp="${ticket.client_response_at || ''}">
                            <h4 style="color: #0046FE; margin: 0 0 10px 0; font-size: 1rem;">üí¨ Respuesta del Cliente</h4>
                            <p style="margin: 0; font-size: 0.9rem; line-height: 1.6; white-space: pre-wrap;">${ticket.client_response}</p>
                            ${ticket.client_response_at ? `<p style="margin: 10px 0 0 0; font-size: 0.8rem; color: #666;">üìÖ Enviado: ${formatDate(ticket.client_response_at)}</p>` : ''}
                            <p style="margin: 10px 0 0 0; font-size: 0.8rem; color: #0046FE; font-weight: 600;">‚ö†Ô∏è El cliente ha respondido - revisa y responde nuevamente si es necesario</p>
                        </div>
                        ` : ''}
                        
                        <!-- Formulario de Respuesta -->
                        ${ticket.status !== 'cerrado' ? `
                        <div style="border: 2px solid #0046FE; border-radius: 10px; padding: 15px;">
                            <h4 style="color: #0046FE; margin: 0 0 12px 0; font-size: 1rem;">‚úâÔ∏è Responder al Cliente</h4>
                            <textarea id="adminResponse" rows="4" style="width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 0.9rem; font-family: inherit; resize: vertical;" placeholder="Escribe tu respuesta aqu√≠..."></textarea>
                            <div style="display: flex; gap: 10px; margin-top: 12px; align-items: center;">
                                <select id="ticketNewStatus" style="padding: 10px; border: 1px solid #e0e0e0; border-radius: 8px; flex: 1;">
                                    <option value="en_proceso" ${ticket.status === 'en_proceso' ? 'selected' : ''}>En Proceso</option>
                                    <option value="cerrado">Cerrado</option>
                                </select>
                                <button onclick="sendTicketResponse(${ticket.id})" class="btn-primary" style="padding: 10px 24px;">
                                    Enviar Respuesta
                                </button>
                            </div>
                        </div>
                        ` : `
                        <div style="background: #e7f5ff; border: 2px solid #0046FE; border-radius: 10px; padding: 15px; text-align: center;">
                            <p style="margin: 0; color: #0046FE; font-weight: 600;">‚úÖ Este ticket ha sido cerrado</p>
                            ${ticket.closed_at ? `<p style="margin: 5px 0 0 0; font-size: 0.85rem; color: #666;">Fecha de cierre: ${formatDate(ticket.closed_at)}</p>` : ''}
                        </div>
                        `}
                    </div>
                `;
                
                // üÜï Registrar el ticket abierto para auto-actualizaci√≥n
                currentOpenAdminTicketId = id;
                document.getElementById('ticketModal').classList.add('active');
                console.log('‚úÖ [ADMIN] Modal de ticket abierto correctamente - Auto-actualizaci√≥n activada');
                
            } catch (error) {
                console.error('‚ùå [ADMIN] Error cargando detalles del ticket:', error);
                showNotification('Error cargando detalles del ticket', 'error');
            }
        }
        
        async function sendTicketResponse(ticketId) {
            const response = document.getElementById('adminResponse').value;
            const newStatus = document.getElementById('ticketNewStatus').value;
            
            console.log('üé´ [ADMIN] sendTicketResponse iniciado');
            console.log('üé´ [ADMIN] ticketId:', ticketId);
            console.log('üé´ [ADMIN] response:', response ? `"${response.substring(0, 50)}..."` : 'VAC√çO');
            console.log('üé´ [ADMIN] newStatus:', newStatus);
            
            if (!response || response.trim() === '') {
                showNotification('Por favor, escribe una respuesta antes de enviar.', 'warning');
                return;
            }
            
            console.log('üé´ [ADMIN] Enviando respuesta para ticket #', ticketId);
            
            const requestBody = {
                admin_response: response,
                status: newStatus
            };
            
            console.log('üé´ [ADMIN] Request body:', requestBody);
            console.log('üé´ [ADMIN] URL:', `${API_URL}/api/tickets/${ticketId}`);
            
            try {
                const res = await fetch(`${API_URL}/api/tickets/${ticketId}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });
                
                console.log('üé´ [ADMIN] Response status:', res.status);
                console.log('üé´ [ADMIN] Response ok?:', res.ok);
                
                if (!res.ok) {
                    const errorText = await res.text();
                    console.error('‚ùå [ADMIN] Error response:', errorText);
                    throw new Error(`HTTP error! status: ${res.status}, message: ${errorText}`);
                }
                
                const data = await res.json();
                console.log('‚úÖ [ADMIN] Respuesta enviada correctamente:', data);
                
                showNotification('Respuesta enviada correctamente. El cliente recibir√° un email.', 'success');
                closeTicketModal();
                loadTickets(); // Recargar tabla
                
            } catch (error) {
                console.error('‚ùå [ADMIN] Error enviando respuesta:', error);
                console.error('‚ùå [ADMIN] Error stack:', error.stack);
                showNotification('Error enviando respuesta: ' + error.message, 'error');
            }
        }

        function closeTicketModal() {
            // üÜï Limpiar el ticket abierto para detener auto-actualizaci√≥n
            currentOpenAdminTicketId = null;
            document.getElementById('ticketModal').classList.remove('active');
            console.log('‚úÖ [ADMIN] Modal cerrado - Auto-actualizaci√≥n del ticket desactivada');
        }

        // ===== PEDIDOS =====
        
        async function loadPedidos() {
            try {
                const response = await fetch(`${API_URL}/api/admin/submissions`);
                const pedidos = await response.json();

                const tbody = document.getElementById('pedidosTable');
                
                if (pedidos.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 40px;">No hay pedidos</td></tr>';
                    return;
                }

                tbody.innerHTML = pedidos.map(pedido => {
                    // Verificar si las modificaciones son NUEVAS (no vistas o vistas antes de la √∫ltima modificaci√≥n)
                    const hasUnviewedModifications = pedido.has_modifications && 
                        (!pedido.modifications_viewed_at || 
                         new Date(pedido.modifications_viewed_at) < new Date(pedido.last_modified_at));
                    
                    return `
                    <tr style="${pedido.has_upgrade || hasUnviewedModifications ? 'background: #f0f9ff;' : ''}">
                        <td><strong>#${pedido.id}</strong></td>
                        <td>
                            ${pedido.business_name || 'N/A'}
                            <div style="margin-top: 5px; display: flex; gap: 5px; flex-wrap: wrap;">
                                ${pedido.has_upgrade ? '<span class="badge" style="background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%); color: white; font-size: 0.7rem; padding: 3px 8px;">üîº UPGRADE</span>' : ''}
                                ${hasUnviewedModifications ? '<span class="badge" style="background: #0046FE; color: white; font-size: 0.7rem; padding: 3px 8px;">‚úèÔ∏è MODIFICADO</span>' : ''}
                            </div>
                        </td>
                        <td>${pedido.email}</td>
                        <td>
                            <span class="badge badge-blue">${formatPlan(pedido.plan)}</span>
                            ${pedido.previous_plan ? `<br><small style="color: #999; font-size: 0.75rem;">Antes: ${formatPlan(pedido.previous_plan)}</small>` : ''}
                        </td>
                        <td><strong>${pedido.amount}‚Ç¨</strong></td>
                        <td><span class="badge badge-${pedido.status === 'paid' ? 'success' : 'warning'}">${formatStatus(pedido.status)}</span></td>
                        <td>
                            ${formatDate(pedido.created_at)}
                            ${pedido.last_modified_at ? `<br><small style="color: #666; font-size: 0.75rem;">Mod: ${formatDate(pedido.last_modified_at)}</small>` : ''}
                        </td>
                        <td><button class="btn-secondary" onclick="viewPedido(${pedido.id})">Ver</button></td>
                    </tr>
                `;
                }).join('');
            } catch (error) {
                console.error('Error cargando pedidos:', error);
            }
        }

        async function viewPedido(id) {
            try {
                console.log('üëÅÔ∏è [ADMIN] Marcando pedido #', id, 'como visto y redirigiendo...');
                
                // Marcar como visto antes de redirigir
                await fetch(`${API_URL}/api/admin/submissions/${id}/mark-viewed`, {
                    method: 'POST'
                });
                
                console.log('‚úÖ [ADMIN] Pedido marcado como visto');
                
                // Redirigir a la p√°gina de detalles
                window.location.href = `/admin-dashboard/pedido-detalle.html?id=${id}`;
                
            } catch (error) {
                console.error('‚ùå [ADMIN] Error marcando como visto:', error);
                // Redirigir de todas formas
                window.location.href = `/admin-dashboard/pedido-detalle.html?id=${id}`;
            }
        }

        async function viewPedidoOLD(id) {
            try {
                console.log('üìã [ADMIN] Cargando detalles del pedido #', id);
                const response = await fetch(`${API_URL}/api/admin/submissions/${id}`);
                const pedido = await response.json();
                
                console.log('üìã [ADMIN] Pedido recibido:', pedido);
                console.log('üìã [ADMIN] Logo URL:', pedido.logo_url);
                console.log('üìã [ADMIN] Additional images:', pedido.additional_images);
                
                const detailsDiv = document.getElementById('pedidoDetails');
                
                // Parsear arrays/objetos JSON
                const pages = pedido.pages ? (typeof pedido.pages === 'string' ? JSON.parse(pedido.pages) : pedido.pages) : [];
                const purpose = pedido.purpose ? (typeof pedido.purpose === 'string' ? JSON.parse(pedido.purpose) : pedido.purpose) : [];
                const contactMethods = pedido.contact_methods ? (typeof pedido.contact_methods === 'string' ? JSON.parse(pedido.contact_methods) : pedido.contact_methods) : [];
                
                detailsDiv.innerHTML = `
                    <div style="max-height: 70vh; overflow-y: auto; padding-right: 10px;">
                        <!-- Header con Plan Contratado y Bot√≥n -->
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 15px; margin-bottom: 20px;">
                            <div style="flex: 1; padding: 20px; background: linear-gradient(135deg, #0046FE 0%, #0036C8 100%); border-radius: 12px; color: white;">
                                <h3 style="margin: 0 0 15px 0; font-size: 1.3rem;">
                                    Plan Contratado
                                    ${pedido.is_upgrade ? '<span style="background: rgba(255, 255, 255, 0.2); padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; margin-left: 10px;">üîº UPGRADE</span>' : ''}
                                </h3>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                                    <div>
                                        <p style="margin: 0; opacity: 0.9; font-size: 0.85rem;">Plan:</p>
                                        <p style="margin: 5px 0 0 0; font-size: 1.2rem; font-weight: 700;">${formatPlan(pedido.plan)}</p>
                                        ${pedido.previous_plan ? `<p style="margin: 5px 0 0 0; font-size: 0.75rem; opacity: 0.8;">Anterior: ${formatPlan(pedido.previous_plan)}</p>` : ''}
                                    </div>
                                    <div><p style="margin: 0; opacity: 0.9; font-size: 0.85rem;">Monto:</p><p style="margin: 5px 0 0 0; font-size: 1.2rem; font-weight: 700;">${pedido.amount}‚Ç¨</p></div>
                                    <div><p style="margin: 0; opacity: 0.9; font-size: 0.85rem;">Estado:</p><p style="margin: 5px 0 0 0;">${formatStatus(pedido.status)}</p></div>
                                    <div><p style="margin: 0; opacity: 0.9; font-size: 0.85rem;">Fecha:</p><p style="margin: 5px 0 0 0;">${formatDate(pedido.created_at)}</p></div>
                                </div>
                            </div>
                            <button 
                                onclick="window.open('/client-dashboard/?email=${encodeURIComponent(pedido.email)}', '_blank')"
                                style="padding: 15px 20px; background: white; border: 2px solid #0046FE; color: #0046FE; border-radius: 10px; font-weight: 600; cursor: pointer; font-size: 0.9rem; white-space: nowrap; transition: all 0.3s ease;">
                                üëÅÔ∏è Ver Dashboard<br>del Cliente
                            </button>
                        </div>
                        
                        <!-- Grid de 2 columnas para el resto -->
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                            
                            <!-- Datos del Negocio -->
                            <div style="border: 2px solid #e0e0e0; border-radius: 10px; padding: 15px;">
                                <h4 style="color: #0046FE; margin: 0 0 12px 0; font-size: 1rem;">üè¢ Datos del Negocio</h4>
                                <div style="font-size: 0.85rem; line-height: 1.6;">
                                    <p style="margin: 5px 0;"><strong>Nombre:</strong> ${pedido.business_name || 'N/A'}</p>
                                    <p style="margin: 5px 0;"><strong>Industria:</strong> ${pedido.industry || 'N/A'}</p>
                                    <p style="margin: 5px 0;"><strong>Descripci√≥n:</strong> ${pedido.business_description || 'N/A'}</p>
                                </div>
                            </div>
                            
                            <!-- Datos del Cliente -->
                            <div style="border: 2px solid #e0e0e0; border-radius: 10px; padding: 15px;">
                                <h4 style="color: #0046FE; margin: 0 0 12px 0; font-size: 1rem;">üë§ Datos del Cliente</h4>
                                <div style="font-size: 0.85rem; line-height: 1.6;">
                                    <p style="margin: 5px 0;"><strong>Nombre:</strong> ${pedido.full_name || 'N/A'}</p>
                                    <p style="margin: 5px 0;"><strong>Email:</strong> ${pedido.email || 'N/A'}</p>
                                    <p style="margin: 5px 0;"><strong>Tel√©fono:</strong> ${pedido.phone || 'N/A'}</p>
                                </div>
                            </div>
                            
                            <!-- Contacto -->
                            <div style="border: 2px solid #e0e0e0; border-radius: 10px; padding: 15px;">
                                <h4 style="color: #0046FE; margin: 0 0 12px 0; font-size: 1rem;">üìû Contacto Web</h4>
                                <div style="font-size: 0.85rem; line-height: 1.6;">
                                    <p style="margin: 5px 0;"><strong>M√©todos de Contacto:</strong> ${contactMethods.join(', ') || 'N/A'}</p>
                                    <p style="margin: 5px 0;"><strong>Email Web:</strong> ${pedido.email_contact || 'N/A'}</p>
                                    <p style="margin: 5px 0;"><strong>Email Formulario:</strong> ${pedido.form_email || 'N/A'}</p>
                                    <p style="margin: 5px 0;"><strong>Tel√©fono:</strong> ${pedido.phone_number || 'N/A'}</p>
                                    <p style="margin: 5px 0;"><strong>WhatsApp:</strong> ${pedido.whatsapp_number || 'N/A'}</p>
                                    <p style="margin: 5px 0;"><strong>Direcci√≥n F√≠sica:</strong> ${pedido.physical_address || 'N/A'}</p>
                                </div>
                            </div>
                            
                            <!-- Redes Sociales -->
                            <div style="border: 2px solid #e0e0e0; border-radius: 10px; padding: 15px;">
                                <h4 style="color: #0046FE; margin: 0 0 12px 0; font-size: 1rem;">üì± Redes Sociales</h4>
                                <div style="font-size: 0.85rem; line-height: 1.6;">
                                    <p style="margin: 5px 0;"><strong>Instagram:</strong> ${pedido.instagram || 'N/A'}</p>
                                    <p style="margin: 5px 0;"><strong>Facebook:</strong> ${pedido.facebook || 'N/A'}</p>
                                    <p style="margin: 5px 0;"><strong>LinkedIn:</strong> ${pedido.linkedin || 'N/A'}</p>
                                    <p style="margin: 5px 0;"><strong>Twitter:</strong> ${pedido.twitter || 'N/A'}</p>
                                </div>
                            </div>
                            
                            <!-- Servicios -->
                            <div style="border: 2px solid #e0e0e0; border-radius: 10px; padding: 15px; grid-column: 1/-1;">
                                <h4 style="color: #0046FE; margin: 0 0 12px 0; font-size: 1rem;">üíº Servicios</h4>
                                <p style="font-size: 0.85rem; margin: 0; line-height: 1.6;">${pedido.services || 'N/A'}</p>
                            </div>
                            
                            <!-- P√°ginas -->
                            <div style="border: 2px solid #e0e0e0; border-radius: 10px; padding: 15px;">
                                <h4 style="color: #0046FE; margin: 0 0 12px 0; font-size: 1rem;">üìÑ P√°ginas</h4>
                                <div style="font-size: 0.85rem;">
                                    ${pages.length > 0 ? pages.map(p => `<div style="padding: 5px; background: #f8f9fa; margin-bottom: 3px; border-radius: 5px;">‚úì ${p}</div>`).join('') : '<p>No especificadas</p>'}
                                </div>
                            </div>
                            
                            <!-- Objetivos -->
                            <div style="border: 2px solid #e0e0e0; border-radius: 10px; padding: 15px;">
                                <h4 style="color: #0046FE; margin: 0 0 12px 0; font-size: 1rem;">üéØ Objetivos</h4>
                                <div style="font-size: 0.85rem; line-height: 1.6;">
                                    <p style="margin: 5px 0;"><strong>Prop√≥sito:</strong> ${purpose.join(', ') || 'N/A'}</p>
                                    <p style="margin: 5px 0;"><strong>P√∫blico:</strong> ${pedido.target_audience || 'N/A'}</p>
                                </div>
                            </div>
                            
                            <!-- Dise√±o -->
                            <div style="border: 2px solid #e0e0e0; border-radius: 10px; padding: 15px;">
                                <h4 style="color: #0046FE; margin: 0 0 12px 0; font-size: 1rem;">üé® Dise√±o</h4>
                                <div style="font-size: 0.85rem; line-height: 1.6;">
                                    <p style="margin: 5px 0;"><strong>Estilo:</strong> ${pedido.design_style || 'N/A'}</p>
                                    <p style="margin: 5px 0;"><strong>Colores:</strong> ${pedido.brand_colors || 'N/A'}</p>
                                    <p style="margin: 5px 0;"><strong>Referencias:</strong> ${pedido.reference_websites || 'N/A'}</p>
                                </div>
                            </div>
                            
                            <!-- SEO y Dominio -->
                            <div style="border: 2px solid #e0e0e0; border-radius: 10px; padding: 15px; grid-column: 1/-1;">
                                <h4 style="color: #0046FE; margin: 0 0 12px 0; font-size: 1rem;">üîç SEO y Dominio</h4>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 0.85rem;">
                                    <p style="margin: 0;"><strong>Dominio Preferido:</strong> ${pedido.domain_name || 'N/A'}</p>
                                    <p style="margin: 0;"><strong>Dominio Alt 1:</strong> ${pedido.domain_alt1 || 'N/A'}</p>
                                    <p style="margin: 0;"><strong>Dominio Alt 2:</strong> ${pedido.domain_alt2 || 'N/A'}</p>
                                    <p style="margin: 0;"><strong>Google Analytics:</strong> ${pedido.has_analytics === 'yes' ? 'S√≠' : (pedido.has_analytics === 'no' ? 'No' : 'N/A')}</p>
                                    <p style="margin: 0; grid-column: 1/-1;"><strong>Palabras Clave SEO:</strong> ${pedido.keywords || 'N/A'}</p>
                                </div>
                            </div>
                            
                            ${pedido.web_texts ? `
                            <!-- Textos Personalizados -->
                            <div style="border: 2px solid #e0e0e0; border-radius: 10px; padding: 15px; grid-column: 1/-1;">
                                <h4 style="color: #0046FE; margin: 0 0 12px 0; font-size: 1rem;">üìù Textos Personalizados</h4>
                                <p style="font-size: 0.85rem; margin: 0; line-height: 1.6; white-space: pre-wrap; background: #f8f9fa; padding: 12px; border-radius: 6px;">${pedido.web_texts}</p>
                            </div>
                            ` : ''}
                            
                            ${pedido.menu_content || pedido.opening_hours || pedido.portfolio_description ? `
                            <!-- Campos Din√°micos por Sector -->
                            <div style="border: 2px solid #009A62; border-radius: 10px; padding: 15px; grid-column: 1/-1; background: rgba(0, 154, 98, 0.02);">
                                <h4 style="color: #009A62; margin: 0 0 15px 0; font-size: 1.1rem;">üçΩÔ∏è Informaci√≥n Espec√≠fica del Sector</h4>
                                <div style="display: grid; gap: 15px;">
                                    ${pedido.menu_content ? `
                                        <div style="border: 1px solid #009A62; border-radius: 8px; padding: 12px; background: white;">
                                            <p style="margin: 0 0 8px 0; font-weight: 700; color: #009A62; font-size: 0.9rem;">üìã Men√∫ (Restaurante/Bar/Cafeter√≠a)</p>
                                            <p style="font-size: 0.85rem; margin: 0; line-height: 1.6; white-space: pre-wrap; background: #f8fef8; padding: 10px; border-radius: 5px;">${pedido.menu_content}</p>
                                        </div>
                                    ` : ''}
                                    ${pedido.opening_hours ? `
                                        <div style="border: 1px solid #009A62; border-radius: 8px; padding: 12px; background: white;">
                                            <p style="margin: 0 0 8px 0; font-weight: 700; color: #009A62; font-size: 0.9rem;">üïê Horarios de Apertura</p>
                                            <p style="font-size: 0.85rem; margin: 0; line-height: 1.6; white-space: pre-wrap; background: #f8fef8; padding: 10px; border-radius: 5px;">${pedido.opening_hours}</p>
                                        </div>
                                    ` : ''}
                                    ${pedido.portfolio_description ? `
                                        <div style="border: 1px solid #009A62; border-radius: 8px; padding: 12px; background: white;">
                                            <p style="margin: 0 0 8px 0; font-weight: 700; color: #009A62; font-size: 0.9rem;">üì∏ Descripci√≥n de Portfolio/Proyectos</p>
                                            <p style="font-size: 0.85rem; margin: 0; line-height: 1.6; white-space: pre-wrap; background: #f8fef8; padding: 10px; border-radius: 5px;">${pedido.portfolio_description}</p>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                            ` : ''}
                            
                            <!-- Fiscal -->
                            <div style="border: 2px solid #e0e0e0; border-radius: 10px; padding: 15px; grid-column: 1/-1;">
                                <h4 style="color: #0046FE; margin: 0 0 12px 0; font-size: 1rem;">‚öñÔ∏è Datos Fiscales</h4>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; font-size: 0.85rem;">
                                    <p style="margin: 0;"><strong>CIF/NIF:</strong> ${pedido.cif_nif || 'N/A'}</p>
                                    <p style="margin: 0;"><strong>Raz√≥n Social:</strong> ${pedido.razon_social || 'N/A'}</p>
                                    <p style="margin: 0; grid-column: 1/-1;"><strong>Direcci√≥n:</strong> ${pedido.direccion_fiscal || 'N/A'}</p>
                                </div>
                            </div>
                            
                            <!-- Archivos e Im√°genes -->
                            <div style="border: 2px solid #e0e0e0; border-radius: 10px; padding: 15px; grid-column: 1/-1;">
                                <h4 style="color: #0046FE; margin: 0 0 12px 0; font-size: 1rem;">üñºÔ∏è Logo e Im√°genes</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
                                    ${pedido.logo_data ? `
                                        <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 10px; text-align: center;">
                                            <p style="margin: 0 0 10px 0; font-weight: 600; font-size: 0.85rem; color: #666;">Logo</p>
                                            <img src="${pedido.logo_data}" alt="Logo" style="max-width: 100%; height: 150px; object-fit: contain; border-radius: 5px; background: #f5f5f5; padding: 10px;">
                                            <a href="${pedido.logo_data}" download="logo.png" style="display: inline-block; margin-top: 8px; color: #0046FE; text-decoration: none; font-size: 0.8rem;">üíæ Descargar</a>
                                            <a href="${pedido.logo_data}" target="_blank" style="display: inline-block; margin-top: 8px; margin-left: 8px; color: #0046FE; text-decoration: none; font-size: 0.8rem;">üîç Ver</a>
                                        </div>
                                    ` : '<p style="color: #999; font-size: 0.9rem;">No se subi√≥ logo</p>'}
                                    
                                    ${pedido.images_data ? (() => {
                                        const images = typeof pedido.images_data === 'string' ? JSON.parse(pedido.images_data) : pedido.images_data;
                                        if (Array.isArray(images) && images.length > 0) {
                                            return images.map((img, index) => `
                                                <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 10px; text-align: center;">
                                                    <p style="margin: 0 0 10px 0; font-weight: 600; font-size: 0.85rem; color: #666;">Imagen ${index + 1}</p>
                                                    <img src="${img}" alt="Imagen ${index + 1}" style="max-width: 100%; height: 150px; object-fit: cover; border-radius: 5px;">
                                                    <a href="${img}" download="imagen-${index + 1}.png" style="display: inline-block; margin-top: 8px; color: #0046FE; text-decoration: none; font-size: 0.8rem;">üíæ Descargar</a>
                                                    <a href="${img}" target="_blank" style="display: inline-block; margin-top: 8px; margin-left: 8px; color: #0046FE; text-decoration: none; font-size: 0.8rem;">üîç Ver</a>
                                                </div>
                `).join('');
                                        }
                                        return '<p style="color: #999; font-size: 0.9rem; grid-column: 1/-1;">No se subieron im√°genes adicionales</p>';
                                    })() : ''}
                                </div>
                            </div>
                            
                        </div>
                    </div>
                `;
                
                document.getElementById('pedidoModal').classList.add('active');
                console.log('‚úÖ [ADMIN] Modal de pedido abierto correctamente');
                
            } catch (error) {
                console.error('‚ùå [ADMIN] Error cargando detalles del pedido:', error);
                showNotification('Error cargando detalles del pedido', 'error');
            }
        }

        function closePedidoModal() {
            document.getElementById('pedidoModal').classList.remove('active');
        }

        // ===== CLIENTES =====
        async function loadClientes() {
            try {
                console.log('üë• [ADMIN] Cargando clientes...');
                console.log('üë• [ADMIN] URL:', `${API_URL}/api/clients`);
                
                const response = await fetch(`${API_URL}/api/clients`);
                console.log('üë• [ADMIN] Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const clientes = await response.json();
                
                console.log('üë• [ADMIN] Clientes recibidos:', clientes.length, 'clientes');
                console.log('üë• [ADMIN] Datos completos:', clientes);

                const tbody = document.getElementById('clientesTable');
                console.log('üë• [ADMIN] Tbody encontrado:', !!tbody);
                
                if (clientes.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 40px;">No hay clientes</td></tr>';
                    console.warn('‚ö†Ô∏è [ADMIN] No hay clientes en la base de datos');
                    return;
                }

                const html = clientes.map((client, index) => {
                    console.log(`üë• [ADMIN] Cliente ${index + 1}:`, {
                        id: client.id,
                        name: client.full_name,
                        email: client.email,
                        business: client.business_name,
                        plan: client.plan,
                        created_at: client.created_at
                    });
                    
                    return `
                    <tr>
                        <td><strong>#${client.id}</strong></td>
                        <td>${client.full_name || 'N/A'}</td>
                        <td>${client.email}</td>
                        <td>${client.business_name || 'N/A'}</td>
                        <td><span class="badge badge-blue">${client.plan || 'Sin plan'}</span></td>
                        <td><span class="badge badge-${client.plan ? 'success' : 'warning'}">${client.plan ? 'Activo' : 'Inactivo'}</span></td>
                        <td>${formatDate(client.created_at)}</td>
                        <td><button class="btn-secondary" onclick="viewClient(${client.id})">Ver</button></td>
                    </tr>
                `;
                }).join('');
                
                console.log('üë• [ADMIN] HTML generado (primeros 200 caracteres):', html.substring(0, 200));
                tbody.innerHTML = html;
                console.log('‚úÖ [ADMIN] Tabla de clientes actualizada correctamente');
            } catch (error) {
                console.error('‚ùå [ADMIN] Error cargando clientes:', error);
                showNotification('Error al cargar clientes: ' + error.message, 'error');
            }
        }

        async function viewClient(id) {
            try {
                console.log(`üëÅÔ∏è [ADMIN] Cargando detalles del cliente #${id}`);
                
                // Mostrar modal con loader
                const modal = document.createElement('div');
                modal.id = 'clientDetailModal';
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.7);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                    padding: 20px;
                `;
                
                modal.innerHTML = `
                    <div style="background: white; border-radius: 15px; padding: 40px; max-width: 900px; width: 100%; max-height: 90vh; overflow-y: auto; position: relative;">
                        <div class="loader">
                            <div class="spinner"></div>
                            <p>Cargando datos del cliente...</p>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Cerrar modal al hacer clic fuera
                modal.onclick = (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                };
                
                // Obtener detalles del cliente
                const response = await fetch(`${API_URL}/api/clients/${id}`);
                const client = await response.json();
                
                console.log('üëÅÔ∏è [ADMIN] Datos del cliente:', client);
                
                // Renderizar contenido del modal
                const content = modal.querySelector('div');
                content.innerHTML = `
                    <button onclick="document.getElementById('clientDetailModal').remove()" 
                            style="position: absolute; top: 20px; right: 20px; background: #f0f0f0; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-size: 1.2rem;">
                        ‚úï
                    </button>
                    
                    <h2 style="color: #0046FE; margin-bottom: 10px;">üë§ Cliente #${client.id}</h2>
                    <p style="color: #666; margin-bottom: 30px;">${client.full_name}</p>
                    
                    <!-- Datos b√°sicos -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px; color: #1B1B1B;">üìã Informaci√≥n B√°sica</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                            <div>
                                <strong>Email:</strong><br>
                                <span style="color: #666;">${client.email}</span>
                            </div>
                            <div>
                                <strong>Plan:</strong><br>
                                <span class="badge badge-blue">${client.plan || 'Sin plan'}</span>
                            </div>
                            <div>
                                <strong>Estado Web:</strong><br>
                                <span class="badge badge-${client.website_status === 'activo' ? 'success' : 'warning'}">${client.website_status || 'N/A'}</span>
                            </div>
                            <div>
                                <strong>Fecha de pago:</strong><br>
                                <span style="color: #666;">${client.payment_date ? formatDate(client.payment_date) : 'N/A'}</span>
                            </div>
                        </div>
                    </div>
                    
                    ${client.submission ? `
                        <!-- Datos del negocio -->
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h3 style="margin-bottom: 15px; color: #1B1B1B;">üè¢ Datos del Negocio</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                                <div>
                                    <strong>Empresa:</strong><br>
                                    <span style="color: #666;">${client.submission.business_name || 'N/A'}</span>
                                </div>
                                <div>
                                    <strong>Sector:</strong><br>
                                    <span style="color: #666;">${client.submission.industry || 'N/A'}</span>
                                </div>
                                <div>
                                    <strong>Dominio:</strong><br>
                                    <span style="color: #666;">${client.submission.domain_name || 'N/A'}</span>
                                </div>
                                <div>
                                    <strong>Tel√©fono:</strong><br>
                                    <span style="color: #666;">${client.submission.phone_number || 'N/A'}</span>
                                </div>
                            </div>
                            
                            ${client.submission.business_description ? `
                                <div style="margin-top: 15px;">
                                    <strong>Descripci√≥n:</strong><br>
                                    <p style="color: #666; margin-top: 5px;">${client.submission.business_description}</p>
                                </div>
                            ` : ''}
                        </div>
                        
                        <!-- Redes Sociales -->
                        ${(client.submission.instagram || client.submission.facebook || client.submission.linkedin) ? `
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                                <h3 style="margin-bottom: 15px; color: #1B1B1B;">üì± Redes Sociales</h3>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                                    ${client.submission.instagram ? `<div><strong>Instagram:</strong><br><a href="https://instagram.com/${client.submission.instagram}" target="_blank" style="color: #0046FE;">@${client.submission.instagram}</a></div>` : ''}
                                    ${client.submission.facebook ? `<div><strong>Facebook:</strong><br><a href="${client.submission.facebook}" target="_blank" style="color: #0046FE;">${client.submission.facebook}</a></div>` : ''}
                                    ${client.submission.linkedin ? `<div><strong>LinkedIn:</strong><br><a href="${client.submission.linkedin}" target="_blank" style="color: #0046FE;">${client.submission.linkedin}</a></div>` : ''}
                                </div>
                            </div>
                        ` : ''}
                    ` : '<p style="color: #999; text-align: center; padding: 20px;">No hay datos de formulario disponibles</p>'}
                    
                    ${client.project ? `
                        <!-- Datos del proyecto -->
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h3 style="margin-bottom: 15px; color: #1B1B1B;">üåê Proyecto Web</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                                <div>
                                    <strong>Nombre:</strong><br>
                                    <span style="color: #666;">${client.project.project_name || client.project.business_name}</span>
                                </div>
                                <div>
                                    <strong>Estado:</strong><br>
                                    <span class="badge badge-${client.project.status === 'entregada' ? 'success' : 'warning'}">${client.project.status}</span>
                                </div>
                                <div>
                                    <strong>Progreso:</strong><br>
                                    <span style="color: #666;">${client.project.progress || 0}%</span>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <!-- Acciones -->
                    <div style="display: flex; gap: 10px; margin-top: 30px;">
                        <button onclick="window.location.href='/admin#section-webs'" class="btn-primary">
                            Ver en Kanban
                        </button>
                        ${client.submission ? `
                            <button onclick="viewSubmissionDetails(${client.submission.id})" class="btn-secondary">
                                Ver Pedido Completo
                            </button>
                        ` : ''}
                        <button onclick="document.getElementById('clientDetailModal').remove()" class="btn-secondary" style="background: #999;">
                            Cerrar
                        </button>
                    </div>
                `;
                
            } catch (error) {
                console.error('‚ùå [ADMIN] Error cargando cliente:', error);
                showNotification('Error cargando datos del cliente', 'error');
                document.getElementById('clientDetailModal')?.remove();
            }
        }

        // üÜï Funci√≥n para arreglar submissions de clientes existentes
        async function fixClientSubmissions() {
            if (!confirm('¬øQuieres vincular las submissions a los clientes que no tienen submission_id?\n\nEsto buscar√° submissions por email y las vincular√° autom√°ticamente.')) {
                return;
            }
            
            try {
                showNotification('üîß Corrigiendo submissions...', 'info');
                
                const response = await fetch(`${API_URL}/api/admin/fix-client-submissions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(`‚úÖ Correcci√≥n completada:\n- ${result.fixed} clientes corregidos\n- ${result.notFound} sin submission\n- ${result.total} total`, 'success');
                    loadClientes(); // Recargar lista
                } else {
                    showNotification('Error en la correcci√≥n', 'error');
                }
                
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error al corregir submissions', 'error');
            }
        }

        // ===== VIDEOS =====
        async function loadVideos() {
            // TODO: Implementar carga de videos desde base de datos
            const videosGrid = document.getElementById('videosGrid');
            videosGrid.innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #999;">
                    <p>Sistema de videos en desarrollo</p>
                    <button class="btn-primary" onclick="openNewVideoModal()" style="margin-top: 15px;">+ A√±adir tu primer video</button>
                </div>
            `;
        }

        function openNewVideoModal() {
            document.getElementById('videoModal').classList.add('active');
        }

        function closeVideoModal() {
            document.getElementById('videoModal').classList.remove('active');
            document.getElementById('videoForm').reset();
        }

        document.getElementById('videoForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            // TODO: Implementar guardado de video
            showNotification('Sistema de videos - Pr√≥ximamente', 'info');
            closeVideoModal();
        });

        // ===== WEBS DESPLEGADAS =====
        let allWebsData = []; // Cache para filtrado r√°pido

        async function loadWebsDesplegadas() {
            try {
                console.log('üåê [ADMIN] Cargando webs desplegadas...');
                
                // Obtenemos todos los clientes
                const response = await fetch(`${API_URL}/api/clients`);
                const clients = await response.json();
                
                console.log('üìä [ADMIN] Total de clientes:', clients.length);
                
                // Filtramos solo los que tienen un plan activo (pagaron)
                allWebsData = clients.filter(client => {
                    const hasPlan = client.plan && client.plan !== 'sin_plan';
                    if (hasPlan) {
                        console.log('‚úÖ Cliente con plan:', client.email, '- Plan:', client.plan, '- WordPress:', client.wordpress_url || 'No configurado');
                    }
                    return hasPlan;
                });
                
                console.log('üéØ [ADMIN] Clientes con plan para gestionar:', allWebsData.length);
                
                renderWebsGrid(allWebsData);
                
            } catch (error) {
                console.error('‚ùå [ADMIN] Error cargando webs:', error);
                document.getElementById('websGrid').innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #999;">
                        <p>Error cargando sitios web</p>
                    </div>
                `;
            }
        }

        function renderWebsGrid(webs) {
            const websGrid = document.getElementById('websGrid');
            const counter = document.getElementById('websCounter');
            
            counter.textContent = webs.length;
            
            if (webs.length === 0) {
                websGrid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: #999;">
                        <div style="font-size: 4rem; margin-bottom: 20px;">üåê</div>
                        <h3 style="color: #666; margin-bottom: 10px;">No hay sitios web desplegados</h3>
                        <p>Los sitios aparecer√°n aqu√≠ cuando los proyectos sean entregados</p>
                    </div>
                `;
                return;
            }
            
            websGrid.innerHTML = webs.map(web => {
                const statusClass = `web-status-${web.website_status || 'en_construccion'}`;
                const statusEmoji = web.website_status === 'activo' ? '‚úÖ' : (web.website_status === 'mantenimiento' ? 'üîß' : 'üî®');
                const statusText = web.website_status === 'activo' ? 'Activo' : (web.website_status === 'mantenimiento' ? 'Mantenimiento' : 'En Construcci√≥n');
                
                const planClass = `plan-${web.plan || 'basico'}`;
                const planText = formatPlan(web.plan);
                
                // Extraer dominio limpio de la URL o mostrar empresa
                let displayDomain = web.business_name || web.full_name || 'Sin nombre';
                let displayUrl = web.website_url || 'Pendiente de configuraci√≥n';
                
                if (web.website_url) {
                    try {
                        const url = new URL(web.website_url);
                        displayDomain = url.hostname.replace('www.', '');
                    } catch (e) {
                        displayDomain = web.website_url;
                    }
                }
                
                return `
                    <div class="web-card">
                        <!-- Screenshot de la Web -->
                        <div class="web-screenshot" ${web.website_url ? `onclick="window.open('${web.website_url}', '_blank')" style="cursor: pointer;"` : 'style="cursor: default;"'}>
                            ${web.website_screenshot_url ? `
                                <img src="${web.website_screenshot_url}" alt="Screenshot de ${displayDomain}" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px 8px 0 0;">
                            ` : `
                                <div style="width: 100%; height: 180px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 8px 8px 0 0; color: white;">
                                    <div style="font-size: 3rem; margin-bottom: 10px;">üåê</div>
                                    <div style="font-size: 0.9rem; opacity: 0.9;">${statusText}</div>
                                </div>
                            `}
                        </div>
                        
                        <div class="web-card-header">
                            <div class="web-domain">
                                <h3 title="${displayDomain}">${displayDomain}</h3>
                                ${web.website_url ? `
                                    <a href="${web.website_url}" target="_blank" class="web-url">
                                        ${web.website_url} üîó
                                    </a>
                                ` : `
                                    <span class="web-url" style="color: #999; cursor: default;">
                                        ${displayUrl}
                                    </span>
                                `}
                            </div>
                            <div class="web-status-badge ${statusClass}">
                                ${statusEmoji} ${statusText}
                            </div>
                        </div>
                        
                        <div class="web-card-info">
                            <div class="web-info-row">
                                <span class="web-info-label">Cliente:</span>
                                <span class="web-info-value">${web.full_name || 'N/A'}</span>
                            </div>
                            <div class="web-info-row">
                                <span class="web-info-label">Empresa:</span>
                                <span class="web-info-value">${web.business_name || 'N/A'}</span>
                            </div>
                            <div class="web-info-row">
                                <span class="web-info-label">Plan:</span>
                                <span class="web-plan-badge ${planClass}">${planText}</span>
                            </div>
                            <div class="web-info-row">
                                <span class="web-info-label">WordPress:</span>
                                <span class="web-info-value" style="font-size: 0.85rem;">${web.wordpress_url ? '‚úÖ Configurado' : '‚ö†Ô∏è Pendiente'}</span>
                            </div>
                        </div>
                        
                        <div class="web-card-actions">
                            ${web.website_url ? `
                                <button class="btn-web-action btn-web-visit" onclick="window.open('${web.website_url}', '_blank')">
                                    üåê Visitar
                                </button>
                            ` : `
                                <button class="btn-web-action" style="opacity: 0.5; cursor: not-allowed;" disabled>
                                    üåê Visitar
                                </button>
                            `}
                            ${web.wordpress_url ? `
                                <button class="btn-web-action" style="background: #21759b;" onclick="window.open('${web.wordpress_url}', '_blank')">
                                    ‚úèÔ∏è WordPress
                                </button>
                            ` : ''}
                            <button class="btn-web-action btn-web-details" onclick="editWebManagement(${web.id})" style="background: #0046FE;">
                                ‚öôÔ∏è Gestionar
                            </button>
                            ${web.website_status === 'en_construccion' ? `
                                <button class="btn-web-action" onclick="activateWebsite(${web.id}, '${web.full_name}', '${web.business_name}')" style="background: #10B981; font-weight: 600;">
                                    üöÄ Activar Web
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Filtros y b√∫squeda
        function filterWebs() {
            const searchTerm = document.getElementById('searchWebsInput').value.toLowerCase();
            const statusFilter = document.getElementById('filterStatusWebs').value;
            const planFilter = document.getElementById('filterPlanWebs').value;
            
            let filtered = allWebsData.filter(web => {
                // B√∫squeda por texto
                const matchesSearch = !searchTerm || 
                    (web.website_url && web.website_url.toLowerCase().includes(searchTerm)) ||
                    (web.full_name && web.full_name.toLowerCase().includes(searchTerm)) ||
                    (web.business_name && web.business_name.toLowerCase().includes(searchTerm)) ||
                    (web.email && web.email.toLowerCase().includes(searchTerm));
                
                // Filtro por estado
                const matchesStatus = !statusFilter || web.website_status === statusFilter;
                
                // Filtro por plan
                const matchesPlan = !planFilter || web.plan === planFilter;
                
                return matchesSearch && matchesStatus && matchesPlan;
            });
            
            renderWebsGrid(filtered);
        }

        function resetWebsFilters() {
            document.getElementById('searchWebsInput').value = '';
            document.getElementById('filterStatusWebs').value = '';
            document.getElementById('filterPlanWebs').value = '';
            renderWebsGrid(allWebsData);
        }

        function viewWebDetails(clientId) {
            // Reutilizamos la funci√≥n viewClient para mostrar todos los detalles
            viewClient(clientId);
        }
        
        // üÜï Funci√≥n para editar gesti√≥n de web (WordPress URL y Screenshot)
        async function editWebManagement(clientId) {
            try {
                console.log('‚öôÔ∏è [ADMIN] Editando gesti√≥n de web para cliente #', clientId);
                
                // Obtener datos del cliente
                const response = await fetch(`${API_URL}/api/clients/${clientId}`);
                const client = await response.json();
                
                console.log('üìã [ADMIN] Cliente:', client);
                
                // Rellenar el formulario
                document.getElementById('webManagementClientId').value = client.id;
                document.getElementById('webManagementInfo').textContent = `${client.full_name} - ${client.business_name || 'N/A'}`;
                
                const websiteLink = document.getElementById('webManagementWebsite').querySelector('a');
                if (client.website_url) {
                    websiteLink.href = client.website_url;
                    websiteLink.textContent = client.website_url + ' üîó';
                } else {
                    websiteLink.textContent = 'Pendiente de configuraci√≥n';
                }
                
                document.getElementById('wordpressUrlInput').value = client.wordpress_url || '';
                document.getElementById('screenshotUrlInput').value = client.website_screenshot_url || '';
                
                // Mostrar modal
                document.getElementById('webManagementModal').classList.add('active');
                
            } catch (error) {
                console.error('‚ùå [ADMIN] Error cargando gesti√≥n de web:', error);
                showNotification('Error al cargar la informaci√≥n', 'error');
            }
        }
        
        function closeWebManagementModal() {
            document.getElementById('webManagementModal').classList.remove('active');
            document.getElementById('webManagementForm').reset();
        }
        
        async function saveWebManagement(event) {
            event.preventDefault();
            
            const clientId = document.getElementById('webManagementClientId').value;
            const wordpress_url = document.getElementById('wordpressUrlInput').value.trim();
            const website_screenshot_url = document.getElementById('screenshotUrlInput').value.trim();
            
            console.log('üíæ [ADMIN] Guardando gesti√≥n de web:', { clientId, wordpress_url, website_screenshot_url });
            
            try {
                const response = await fetch(`${API_URL}/api/admin/website-management/${clientId}`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        wordpress_url: wordpress_url || null,
                        website_screenshot_url: website_screenshot_url || null
                    })
                });
                
                if (!response.ok) throw new Error('Error al guardar');
                
                const result = await response.json();
                console.log('‚úÖ [ADMIN] Gesti√≥n guardada:', result);
                
                showNotification('Cambios guardados correctamente', 'success');
                closeWebManagementModal();
                
                // Recargar las webs para mostrar los cambios
                loadWebsDesplegadas();
                
            } catch (error) {
                console.error('‚ùå [ADMIN] Error guardando gesti√≥n:', error);
                showNotification('Error al guardar los cambios', 'error');
            }
        }
        
        // Funci√≥n para activar una web y notificar al cliente
        async function activateWebsite(clientId, clientName, businessName) {
            const displayName = businessName || clientName || 'el cliente';
            
            const confirmed = await showConfirmation(
                `üöÄ ¬øActivar la web de "${displayName}"?\n\n` +
                `Al confirmar:\n` +
                `‚Ä¢ El proyecto se marcar√° como entregado\n` +
                `‚Ä¢ Se notificar√° al cliente por email\n` +
                `‚Ä¢ La web aparecer√° como "Activa" en su dashboard`
            );
            
            if (!confirmed) {
                console.log('‚ö†Ô∏è [ADMIN] Activaci√≥n cancelada por el usuario');
                return;
            }
            
            try {
                console.log(`üöÄ [ADMIN] Activando web para cliente #${clientId}`);
                
                // 1. Actualizar estado del cliente a "activo"
                console.log('üì§ [ADMIN] Paso 1: Actualizando estado del cliente...');
                const clientResponse = await fetch(`${API_URL}/api/client/website-status/${clientId}`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        status: 'activo',
                        website_url: null  // Mantener la URL actual
                    })
                });
                
                if (!clientResponse.ok) {
                    throw new Error(`Error actualizando cliente: ${clientResponse.status}`);
                }
                
                console.log('‚úÖ [ADMIN] Cliente actualizado a estado "activo"');
                
                // 2. Buscar y actualizar el proyecto asociado a "entregada"
                console.log('üì§ [ADMIN] Paso 2: Buscando proyecto del cliente...');
                const projectsResponse = await fetch(`${API_URL}/api/admin/projects`);
                const allProjects = await projectsResponse.json();
                const clientProject = allProjects.find(p => p.client_id === clientId);
                
                if (clientProject) {
                    console.log(`üì§ [ADMIN] Paso 3: Actualizando proyecto #${clientProject.id} a "entregada"...`);
                    const projectResponse = await fetch(`${API_URL}/api/admin/projects/${clientProject.id}`, {
                        method: 'PATCH',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ status: 'entregada' })
                    });
                    
                    if (!projectResponse.ok) {
                        throw new Error(`Error actualizando proyecto: ${projectResponse.status}`);
                    }
                    
                    console.log('‚úÖ [ADMIN] Proyecto marcado como "entregada"');
                } else {
                    console.warn('‚ö†Ô∏è [ADMIN] No se encontr√≥ proyecto asociado al cliente');
                }
                
                // 3. Mostrar notificaci√≥n de √©xito
                showNotification(
                    `üéâ ¬°Web activada exitosamente!\n\n` +
                    `‚úÖ Estado cambiado a "Activo"\n` +
                    `‚úÖ Proyecto marcado como "Entregado"\n` +
                    `‚úÖ El cliente ha sido notificado`,
                    'success'
                );
                
                // 4. Recargar las webs desplegadas para mostrar el cambio
                console.log('üîÑ [ADMIN] Recargando webs desplegadas...');
                await loadWebsDesplegadas();
                
                console.log('‚úÖ [ADMIN] Activaci√≥n completada exitosamente');
                
            } catch (error) {
                console.error('‚ùå [ADMIN] Error activando web:', error);
                showNotification(
                    'Error al activar la web: ' + error.message,
                    'error'
                );
            }
        }

        async function deployWebFromProject() {
            const form = document.getElementById('projectForm');
            const clientId = form.dataset.clientId;
            const projectName = document.getElementById('projectName').value;
            
            if (!clientId) {
                showNotification('No se pudo identificar el cliente', 'error');
                return;
            }
            
            const confirmed = await showConfirmation(
                `üöÄ ¬øCrear "${projectName}" en Webs Desplegadas?\n\n` +
                `Esta acci√≥n:\n` +
                `‚Ä¢ Crear√° una entrada en la secci√≥n "Webs Desplegadas"\n` +
                `‚Ä¢ Permitir√° configurar el enlace de WordPress\n` +
                `‚Ä¢ Solo se puede hacer una vez por proyecto\n\n` +
                `¬øContinuar?`
            );
            
            if (!confirmed) {
                console.log('‚ö†Ô∏è [ADMIN] Despliegue cancelado');
                return;
            }
            
            try {
                console.log(`üöÄ [ADMIN] Desplegando web para cliente #${clientId}`);
                
                // Crear entrada en "Webs Desplegadas" agregando un placeholder en wordpress_url
                const response = await fetch(`${API_URL}/api/admin/website-management/${clientId}`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        wordpress_url: 'PENDIENTE', // Marcador para indicar que est√° en proceso
                        website_screenshot_url: null
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Error al crear entrada en Webs Desplegadas');
                }
                
                console.log('‚úÖ [ADMIN] Entrada creada en Webs Desplegadas');
                
                showNotification(
                    `üéâ ¬°Web desplegada!\n\n` +
                    `‚úÖ "${projectName}" ahora aparece en Webs Desplegadas\n` +
                    `üìù Ve a "Webs Desplegadas" para configurar WordPress`,
                    'success'
                );
                
                // Actualizar el bot√≥n a estado deshabilitado
                const deployButton = document.getElementById('deployWebButton');
                deployButton.disabled = true;
                deployButton.style.opacity = '0.5';
                deployButton.style.cursor = 'not-allowed';
                deployButton.textContent = '‚úÖ Ya Desplegado';
                
                // Actualizar el clientId en el dataset para reflejar el cambio
                form.dataset.wordpressConfigured = 'true';
                
            } catch (error) {
                console.error('‚ùå [ADMIN] Error desplegando web:', error);
                showNotification(
                    'Error al desplegar la web: ' + error.message,
                    'error'
                );
            }
        }

        // ===== FACTURAS =====
        let allInvoicesData = [];
        let filteredInvoicesData = [];
        let currentPeriod = 'week';

        async function loadAllInvoices() {
            try {
                console.log('üßæ [ADMIN] Cargando todas las facturas...');
                
                const tbody = document.getElementById('invoicesTable');
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px;"><div class="loader"><div class="spinner"></div><p>Cargando facturas...</p></div></td></tr>';
                
                const response = await fetch(`${API_URL}/api/admin/invoices`);
                
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
                const data = await response.json();
                
                allInvoicesData = data.invoices || [];
                console.log(`‚úÖ [ADMIN] ${allInvoicesData.length} facturas cargadas desde Stripe`);
                
                // Aplicar filtro inicial (√∫ltima semana)
                filterInvoicesByPeriod(currentPeriod);
                
            } catch (error) {
                console.error('‚ùå [ADMIN] Error cargando facturas:', error);
                const tbody = document.getElementById('invoicesTable');
                tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; padding: 40px; color: #EF4444;">Error al cargar las facturas: ${error.message}</td></tr>`;
            }
        }

        function filterInvoicesByPeriod(period) {
            currentPeriod = period;
            console.log(`üìÖ [ADMIN] Filtrando facturas por: ${period}`);
            
            // Actualizar botones activos
            document.querySelectorAll('.btn-filter').forEach(btn => {
                if (btn.dataset.period === period) {
                    btn.style.background = '#0046FE';
                    btn.style.color = 'white';
                    btn.style.borderColor = '#0046FE';
                } else {
                    btn.style.background = 'white';
                    btn.style.color = '#333';
                    btn.style.borderColor = '#e0e0e0';
                }
            });
            
            const now = new Date();
            let startDate;
            
            switch(period) {
                case 'week':
                    startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    break;
                case 'month':
                    startDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                    break;
                case 'quarter':
                    startDate = new Date(now.getTime() - 90 * 24 * 60 * 60 * 1000);
                    break;
                case 'year':
                    startDate = new Date(now.getTime() - 365 * 24 * 60 * 60 * 1000);
                    break;
                case 'all':
                    startDate = new Date(0); // Desde el inicio de los tiempos
                    break;
                default:
                    startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            }
            
            // Filtrar facturas por fecha
            filteredInvoicesData = allInvoicesData.filter(invoice => {
                const invoiceDate = new Date(invoice.created);
                return invoiceDate >= startDate;
            });
            
            console.log(`‚úÖ [ADMIN] ${filteredInvoicesData.length} facturas en el per√≠odo seleccionado`);
            
            // Renderizar
            renderInvoicesTable();
            updateInvoicesStats();
        }

        function renderInvoicesTable() {
            const tbody = document.getElementById('invoicesTable');
            
            if (filteredInvoicesData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #999;">No hay facturas en este per√≠odo</td></tr>';
                return;
            }
            
            tbody.innerHTML = filteredInvoicesData.map(invoice => {
                const date = new Date(invoice.created).toLocaleDateString('es-ES', { 
                    day: 'numeric', 
                    month: 'short', 
                    year: 'numeric' 
                });
                
                const statusColors = {
                    'paid': { badge: 'success', text: 'Pagada' },
                    'open': { badge: 'warning', text: 'Pendiente' },
                    'void': { badge: 'secondary', text: 'Anulada' },
                    'uncollectible': { badge: 'danger', text: 'Impagada' }
                };
                
                const status = statusColors[invoice.status] || { badge: 'secondary', text: invoice.status };
                
                return `
                    <tr>
                        <td><strong>${invoice.number}</strong></td>
                        <td>${invoice.client_name || 'N/A'}</td>
                        <td>${invoice.client_business || invoice.client_email || 'N/A'}</td>
                        <td><strong>${invoice.amount}‚Ç¨</strong></td>
                        <td><span class="badge badge-${status.badge}">${status.text}</span></td>
                        <td>${date}</td>
                        <td>
                            ${invoice.pdf_url ? `
                                <a href="${invoice.pdf_url}" target="_blank" class="btn-secondary" style="padding: 6px 12px; font-size: 0.85rem; text-decoration: none; display: inline-block;">
                                    üì• PDF
                                </a>
                            ` : '<span style="color: #999;">N/A</span>'}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function updateInvoicesStats() {
            const totalInvoices = filteredInvoicesData.length;
            const paidInvoices = filteredInvoicesData.filter(inv => inv.status === 'paid').length;
            const pendingInvoices = filteredInvoicesData.filter(inv => inv.status === 'open').length;
            const totalRevenue = filteredInvoicesData
                .filter(inv => inv.status === 'paid')
                .reduce((sum, inv) => sum + parseFloat(inv.amount), 0);
            
            document.getElementById('totalInvoices').textContent = totalInvoices;
            document.getElementById('paidInvoices').textContent = paidInvoices;
            document.getElementById('pendingInvoices').textContent = pendingInvoices;
            document.getElementById('totalRevenue').textContent = `${totalRevenue.toFixed(2)}‚Ç¨`;
        }

        function exportInvoices() {
            if (filteredInvoicesData.length === 0) {
                showNotification('No hay facturas para exportar en este per√≠odo', 'error');
                return;
            }
            
            console.log('üì• [ADMIN] Exportando facturas a CSV...');
            
            // Crear CSV con facturas filtradas
            const headers = ['N¬∫ Factura', 'Cliente', 'Empresa', 'Email', 'Monto', 'Moneda', 'Estado', 'Fecha', 'PDF URL'];
            const rows = filteredInvoicesData.map(inv => [
                inv.number,
                inv.client_name || '',
                inv.client_business || '',
                inv.client_email || '',
                inv.amount,
                inv.currency,
                inv.status,
                new Date(inv.created).toLocaleDateString('es-ES'),
                inv.pdf_url || ''
            ]);
            
            let csvContent = headers.join(',') + '\n';
            rows.forEach(row => {
                csvContent += row.map(field => `"${field}"`).join(',') + '\n';
            });
            
            // Descargar archivo
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `facturas_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            console.log('‚úÖ [ADMIN] CSV descargado');
            showNotification('Facturas exportadas correctamente', 'success');
        }

        // Event listeners para filtros
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('searchWebsInput');
            const statusFilter = document.getElementById('filterStatusWebs');
            const planFilter = document.getElementById('filterPlanWebs');
            
            if (searchInput) {
                searchInput.addEventListener('input', filterWebs);
            }
            if (statusFilter) {
                statusFilter.addEventListener('change', filterWebs);
            }
            if (planFilter) {
                planFilter.addEventListener('change', filterWebs);
            }
        });

        // ===== PROYECTOS (KANBAN) =====
        async function loadProjects() {
            try {
                console.log('üìã [ADMIN] Cargando proyectos para Kanban...');
                const response = await fetch(`${API_URL}/api/admin/projects`);
                const projects = await response.json();
                
                console.log('üìã [ADMIN] Proyectos recibidos:', projects.length, 'proyectos');
                console.log('üìã [ADMIN] Datos completos:', projects);
                
                // Mapeo de estados del backend al frontend
                const statusMapping = {
                    'sin_empezar': 'sin-empezar',
                    'en_desarrollo': 'desarrollo',
                    'revision': 'revision',
                    'entregada': 'entregada'
                };
                
                // Limpiar todas las columnas
                Object.values(statusMapping).forEach(columnId => {
                    const column = document.getElementById(`kanban-${columnId}`);
                    if (column) column.innerHTML = '';
                });
                
                // Agrupar proyectos por estado (usando estados del backend)
                const projectsByStatus = {
                    'sin_empezar': [],
                    'en_desarrollo': [],
                    'revision': [],
                    'entregada': []
                };
                
                console.log('üîç [DEBUG] Iniciando iteraci√≥n de proyectos...');
                console.log('üîç [DEBUG] Array projects:', Array.isArray(projects), 'Length:', projects.length);
                
                projects.forEach((project, index) => {
                    console.log(`\nüìã [ADMIN] === Proyecto ${index + 1}/${projects.length} ===`);
                    console.log(`üìã [ADMIN] ID: ${project.id}`);
                    console.log(`üìã [ADMIN] Nombre: "${project.project_name || project.business_name}"`);
                    console.log(`üìã [ADMIN] Estado: "${project.status}"`);
                    console.log(`üìã [ADMIN] Cliente: ${project.client_email}`);
                    
                    if (projectsByStatus[project.status] !== undefined) {
                        projectsByStatus[project.status].push(project);
                        console.log(`‚úÖ [ADMIN] Proyecto agregado a: ${project.status}`);
                    } else {
                        console.error(`‚ùå [ADMIN] Estado desconocido: "${project.status}"`);
                        console.error(`‚ùå [ADMIN] Estados v√°lidos:`, Object.keys(projectsByStatus));
                    }
                });
                
                console.log('\nüîç [DEBUG] Iteraci√≥n completada');
                
                console.log('üìã [ADMIN] Proyectos agrupados:', {
                    sin_empezar: projectsByStatus.sin_empezar.length,
                    en_desarrollo: projectsByStatus.en_desarrollo.length,
                    revision: projectsByStatus.revision.length,
                    entregada: projectsByStatus.entregada.length
                });
                
                // Renderizar proyectos en cada columna
                Object.keys(projectsByStatus).forEach(backendStatus => {
                    const columnId = statusMapping[backendStatus];
                    const column = document.getElementById(`kanban-${columnId}`);
                    const count = document.getElementById(`count-${columnId}`);
                    
                    if (!column || !count) {
                        console.error(`‚ùå [ADMIN] Columna no encontrada: kanban-${columnId}`);
                        return;
                    }
                    
                    const projectList = projectsByStatus[backendStatus] || [];
                    count.textContent = projectList.length;
                    
                    console.log(`üé® [RENDER] Columna: ${columnId}, Proyectos: ${projectList.length}`);
                    
                    if (projectList.length === 0) {
                        console.log(`üì≠ [RENDER] Columna ${columnId} vac√≠a, mostrando mensaje`);
                        column.innerHTML = `
                            <div style="text-align: center; padding: 20px; color: #999; font-size: 0.9rem;">
                                Sin proyectos
                            </div>
                        `;
                    } else {
                        console.log(`üé® [RENDER] Renderizando ${projectList.length} proyecto(s) en ${columnId}`);
                        const html = projectList.map((project, idx) => {
                            console.log(`  üé® [RENDER] Proyecto ${idx + 1}: ${project.project_name || project.business_name}`);
                            return `
                                <div class="kanban-card" draggable="true" data-project-id="${project.id}" ${project.is_upgrade ? 'style="border-left: 4px solid #ff6b35;"' : ''}>
                                    <div class="kanban-card-title">
                                        ${project.project_name || project.business_name || 'Proyecto sin nombre'}
                                        ${project.is_upgrade ? '<span class="badge" style="background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%); color: white; margin-left: 8px; font-size: 0.7rem; padding: 3px 8px;">üîº UPGRADE</span>' : ''}
                                    </div>
                                    <div class="kanban-card-info">üë§ ${project.business_name || 'Sin cliente'}</div>
                                    <div class="kanban-card-info">üìß ${project.client_email || 'N/A'}</div>
                                    <div class="kanban-card-info">üì¶ ${project.plan === 'basico' ? 'B√°sico' : project.plan === 'avanzado' ? 'Avanzado' : project.plan === 'premium' ? 'Premium' : project.plan}</div>
                                    ${project.deadline ? `<div class="kanban-card-info">üìÖ ${formatDate(project.deadline)}</div>` : ''}
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: ${project.progress || 0}%"></div>
                                    </div>
                                    <div class="kanban-card-footer">
                                        <span>${project.priority === 'low' ? 'üü¢' : project.priority === 'high' ? 'üü†' : project.priority === 'urgent' ? 'üî¥' : 'üîµ'} ${project.priority || 'normal'}</span>
                                        <span>${project.progress || 0}%</span>
                                    </div>
                                </div>
                            `;
                        }).join('');
                        
                        console.log(`üìù [RENDER] HTML generado (${html.length} caracteres)`);
                        column.innerHTML = html;
                        console.log(`‚úÖ [RENDER] innerHTML asignado a columna ${columnId}`);
                        
                        // Verificar que realmente se renderiz√≥
                        const cardsInColumn = column.querySelectorAll('.kanban-card').length;
                        console.log(`‚úÖ [RENDER] Tarjetas encontradas en ${columnId}: ${cardsInColumn}`);
                        
                        // A√±adir event listeners para drag & drop
                        column.querySelectorAll('.kanban-card').forEach(card => {
                            card.addEventListener('dragstart', handleDragStart);
                            card.addEventListener('click', () => editProject(card.dataset.projectId));
                        });
                    }
                });
                
                // A√±adir event listeners para drop zones
                Object.keys(projectsByStatus).forEach(backendStatus => {
                    const columnId = statusMapping[backendStatus];
                    const column = document.getElementById(`kanban-${columnId}`)?.parentElement;
                    if (column) {
                        column.addEventListener('dragover', handleDragOver);
                        column.addEventListener('drop', (e) => handleDrop(e, backendStatus));
                    }
                });
                
                // Actualizar estad√≠sticas (opcional, no bloquea si falla)
                try {
                    const statsResponse = await fetch(`${API_URL}/api/admin/projects/stats`);
                    if (statsResponse.ok) {
                        const stats = await statsResponse.json();
                        if (document.getElementById('websInProgress')) {
                            document.getElementById('websInProgress').textContent = stats.en_desarrollo || 0;
                        }
                    }
                } catch (statsError) {
                    console.warn('‚ö†Ô∏è [ADMIN] No se pudieron cargar estad√≠sticas de proyectos:', statsError);
                }
                
                console.log('‚úÖ [ADMIN] Proyectos cargados correctamente en Kanban');
                
            } catch (error) {
                console.error('‚ùå [ADMIN] Error cargando proyectos:', error);
            }
        }
        
        // Drag & Drop handlers
        let draggedProject = null;
        
        function handleDragStart(e) {
            draggedProject = e.target;
            e.dataTransfer.effectAllowed = 'move';
            e.target.style.opacity = '0.5';
        }
        
        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }
        
        async function handleDrop(e, newStatus) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            
            if (draggedProject) {
                const projectId = draggedProject.dataset.projectId;
                draggedProject.style.opacity = '';
                
                console.log(`üéØ [ADMIN] Moviendo proyecto #${projectId} a estado: ${newStatus}`);
                
                // Si se mueve a "Entregada", pedir confirmaci√≥n
                if (newStatus === 'entregada') {
                    const confirmed = await showConfirmation(
                        'üöÄ ¬øMarcar como ENTREGADO?\n\n' +
                        'Al confirmar:\n' +
                        '‚Ä¢ El cliente ser√° notificado\n' +
                        '‚Ä¢ La web aparecer√° como "Activa"\n' +
                        '‚Ä¢ El progreso se completar√° al 100%'
                    );
                    
                    if (!confirmed) {
                        console.log('‚ö†Ô∏è [ADMIN] Movimiento cancelado por el usuario');
                        return false;
                    }
                }
                
                try {
                    // Calcular progreso autom√°tico seg√∫n la columna
                    const progressByStatus = {
                        'sin_empezar': 0,
                        'en_desarrollo': 50,
                        'revision': 75,
                        'entregada': 100
                    };
                    
                    const autoProgress = progressByStatus[newStatus] !== undefined ? progressByStatus[newStatus] : 0;
                    console.log(`üìä [ADMIN] Progreso autom√°tico para '${newStatus}': ${autoProgress}%`);
                    
                    // Actualizar estado Y progreso en el backend
                    console.log(`üì§ [ADMIN] Enviando PATCH a /api/admin/projects/${projectId} con status: ${newStatus} y progress: ${autoProgress}`);
                    const updateResponse = await fetch(`${API_URL}/api/admin/projects/${projectId}`, {
                        method: 'PATCH',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            status: newStatus,
                            progress: autoProgress
                        })
                    });
                    
                    if (!updateResponse.ok) {
                        throw new Error(`Error ${updateResponse.status}: ${await updateResponse.text()}`);
                    }
                    
                    const result = await updateResponse.json();
                    console.log(`‚úÖ [ADMIN] Proyecto actualizado:`, result);
                    
                    // Si se marc√≥ como entregada, actualizar el cliente
                    if (newStatus === 'entregada') {
                        const projectResponse = await fetch(`${API_URL}/api/admin/projects/${projectId}`);
                        const project = await projectResponse.json();
                        
                        if (project.client_id) {
                            // Actualizar estado del sitio web del cliente a "activo"
                            await fetch(`${API_URL}/api/client/website-status/${project.client_id}`, {
                                method: 'PATCH',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ 
                                    status: 'activo',
                                    website_url: project.website_url || null
                                })
                            });
                            
                            showNotification('Proyecto marcado como entregado. El cliente ha sido notificado y su sitio est√° ahora ACTIVO.', 'success');
                        }
                    } else {
                        showNotification('Proyecto movido exitosamente', 'success');
                    }
                    
                    // Recargar proyectos
                    console.log('üîÑ [ADMIN] Recargando proyectos despu√©s de mover...');
                    await loadProjects();
                    console.log('‚úÖ [ADMIN] Proyectos recargados');
                } catch (error) {
                    console.error('‚ùå [ADMIN] Error moviendo proyecto:', error);
                    showNotification('Error moviendo el proyecto: ' + error.message, 'error');
                    // Recargar de todos modos para restaurar el estado visual
                    await loadProjects();
                }
            }
            
            return false;
        }
        
        // Editar proyecto
        async function editProject(projectId) {
            try {
                console.log(`üìù [ADMIN] Editando proyecto #${projectId}`);
                
                // 1Ô∏è‚É£ Obtener datos del proyecto
                const response = await fetch(`${API_URL}/api/admin/projects/${projectId}`);
                const project = await response.json();
                console.log('üìù [ADMIN] Datos del proyecto:', project);
                
                // 2Ô∏è‚É£ Cargar clientes PRIMERO
                console.log('üìù [ADMIN] Cargando clientes para dropdown...');
                await loadClientsForSelect();
                
                // 3Ô∏è‚É£ AHORA s√≠, pre-llenar modal con datos del proyecto
                console.log(`üìù [ADMIN] Asignando cliente #${project.client_id} al dropdown`);
                document.getElementById('projectClient').value = project.client_id;
                document.getElementById('projectName').value = project.project_name;
                document.getElementById('projectStatus').value = project.status;
                document.getElementById('projectPriority').value = project.priority;
                
                // Formatear deadline para input type="date" (YYYY-MM-DD)
                console.log(`üìÖ [ADMIN] Deadline original:`, project.deadline);
                let formattedDeadline = '';
                if (project.deadline) {
                    // Si viene como Date object o string, convertir a YYYY-MM-DD
                    const deadlineDate = new Date(project.deadline);
                    if (!isNaN(deadlineDate.getTime())) {
                        formattedDeadline = deadlineDate.toISOString().split('T')[0];
                        console.log(`üìÖ [ADMIN] Deadline formateado: ${formattedDeadline}`);
                    } else {
                        console.warn(`‚ö†Ô∏è [ADMIN] Deadline inv√°lido: ${project.deadline}`);
                    }
                }
                document.getElementById('projectDeadline').value = formattedDeadline;
                console.log(`üìÖ [ADMIN] Deadline asignado al input:`, document.getElementById('projectDeadline').value);
                
                document.getElementById('projectProgress').value = project.progress;
                document.getElementById('projectNotes').value = project.notes || '';
                
                // Verificar si el cliente se asign√≥ correctamente
                const selectedClientId = document.getElementById('projectClient').value;
                console.log(`üìù [ADMIN] Cliente seleccionado en dropdown: ${selectedClientId}`);
                
                if (selectedClientId != project.client_id) {
                    console.warn(`‚ö†Ô∏è [ADMIN] El cliente no se asign√≥ correctamente. Esperado: ${project.client_id}, Actual: ${selectedClientId}`);
                }
                
                // 4Ô∏è‚É£ Obtener datos del cliente para verificar si ya tiene WordPress configurado
                let clientHasWordPress = false;
                if (project.client_id) {
                    try {
                        const clientResponse = await fetch(`${API_URL}/api/clients/${project.client_id}`);
                        const clientData = await clientResponse.json();
                        clientHasWordPress = !!(clientData.wordpress_url);
                        console.log(`üîç [ADMIN] Cliente tiene WordPress configurado: ${clientHasWordPress ? 'S√ç' : 'NO'}`);
                    } catch (err) {
                        console.warn('‚ö†Ô∏è [ADMIN] No se pudo obtener datos del cliente:', err);
                    }
                }
                
                // 5Ô∏è‚É£ Mostrar/ocultar bot√≥n "Crear en Webs Desplegadas"
                const deployButton = document.getElementById('deployWebButton');
                if (clientHasWordPress) {
                    // Ya tiene WordPress configurado - bot√≥n deshabilitado
                    deployButton.style.display = 'block';
                    deployButton.disabled = true;
                    deployButton.style.opacity = '0.5';
                    deployButton.style.cursor = 'not-allowed';
                    deployButton.textContent = '‚úÖ Ya Desplegado';
                    deployButton.title = 'Este proyecto ya tiene WordPress configurado';
                } else {
                    // No tiene WordPress - bot√≥n activo
                    deployButton.style.display = 'block';
                    deployButton.disabled = false;
                    deployButton.style.opacity = '1';
                    deployButton.style.cursor = 'pointer';
                    deployButton.textContent = 'üöÄ Crear en Webs Desplegadas';
                    deployButton.title = 'Configurar WordPress y activar la web';
                }
                
                // Cambiar el formulario a modo edici√≥n
                const form = document.getElementById('projectForm');
                form.dataset.projectId = projectId;
                form.dataset.clientId = project.client_id; // Guardar client_id para el bot√≥n
                form.dataset.mode = 'edit';
                
                // Cambiar t√≠tulo del modal
                document.querySelector('#projectModal .modal-header h3').textContent = '‚úèÔ∏è Editar Proyecto';
                
                document.getElementById('projectModal').classList.add('active');
                console.log('‚úÖ [ADMIN] Modal de edici√≥n abierto correctamente');
            } catch (error) {
                console.error('‚ùå [ADMIN] Error cargando datos del proyecto:', error);
                showNotification('Error cargando datos del proyecto', 'error');
            }
        }

        function openNewProjectModal() {
            const form = document.getElementById('projectForm');
            delete form.dataset.projectId;
            delete form.dataset.clientId;
            delete form.dataset.mode;
            form.reset();
            document.querySelector('#projectModal .modal-header h3').textContent = 'üåê Nuevo Proyecto';
            
            // Ocultar bot√≥n "Crear en Webs Desplegadas" en modo creaci√≥n
            document.getElementById('deployWebButton').style.display = 'none';
            
            document.getElementById('projectModal').classList.add('active');
            loadClientsForSelect();
        }

        function closeProjectModal() {
            document.getElementById('projectModal').classList.remove('active');
            const form = document.getElementById('projectForm');
            form.reset();
            delete form.dataset.projectId;
            delete form.dataset.mode;
        }

        async function loadClientsForSelect() {
            try {
                console.log('üîç [ADMIN] Cargando clientes para dropdown...');
                const response = await fetch(`${API_URL}/api/clients`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const clients = await response.json();
                console.log(`üìã [ADMIN] Clientes recibidos:`, clients);
                console.log(`üìä [ADMIN] Total de clientes: ${clients.length}`);
                
                const select = document.getElementById('projectClient');
                
                if (clients.length === 0) {
                    console.warn('‚ö†Ô∏è [ADMIN] No hay clientes disponibles');
                    select.innerHTML = '<option value="">No hay clientes disponibles</option>';
                    return;
                }
                
                select.innerHTML = '<option value="">Selecciona un cliente...</option>' +
                    clients.map(c => {
                        const clientName = c.full_name || c.email || 'Sin nombre';
                        console.log(`‚ûï [ADMIN] Agregando cliente: ${clientName} (ID: ${c.id}, Email: ${c.email})`);
                        return `<option value="${c.id}">${clientName} (${c.email})</option>`;
                    }).join('');
                    
                console.log('‚úÖ [ADMIN] Dropdown de clientes cargado correctamente');
            } catch (error) {
                console.error('‚ùå [ADMIN] Error cargando clientes:', error);
                showNotification('Error al cargar clientes: ' + error.message, 'error');
            }
        }

        document.getElementById('projectForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const form = e.target;
            const projectData = {
                client_id: parseInt(document.getElementById('projectClient').value),
                project_name: document.getElementById('projectName').value,
                // status: No se env√≠a, se cambia solo arrastrando en el Kanban
                priority: document.getElementById('projectPriority').value,
                deadline: document.getElementById('projectDeadline').value || null,
                progress: parseInt(document.getElementById('projectProgress').value),
                notes: document.getElementById('projectNotes').value || null
            };
            
            try {
                if (form.dataset.mode === 'edit' && form.dataset.projectId) {
                    // Modo edici√≥n
                    await fetch(`${API_URL}/api/admin/projects/${form.dataset.projectId}`, {
                        method: 'PATCH',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(projectData)
                    });
                    showNotification('Proyecto actualizado exitosamente', 'success');
                } else {
                    // Modo creaci√≥n
                    await fetch(`${API_URL}/api/admin/projects`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(projectData)
                    });
                    showNotification('Proyecto creado exitosamente', 'success');
                }
                
                closeProjectModal();
                await loadProjects();
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error guardando el proyecto', 'error');
            }
        });

        // ===== ACTUALIZACI√ìN AUTOM√ÅTICA DE TICKETS =====
        let autoUpdateIntervalAdmin = null;

        // Variable para rastrear el ticket actualmente abierto en admin
        let currentOpenAdminTicketId = null;

        async function updateAdminUnreadBadge() {
            try {
                console.log('üîÑ [AUTO-UPDATE ADMIN] Actualizando contador de mensajes...');
                const response = await fetch(`${API_URL}/api/tickets`);
                
                if (!response.ok) return;
                
                const allTickets = await response.json();
                
                // FILTRAR: Excluir tickets de facturaci√≥n (upgrades/downgrades autom√°ticos)
                const tickets = allTickets.filter(t => t.category !== 'facturacion');
                
                // Contar mensajes sin leer del admin
                const unreadCount = tickets.filter(t => t.admin_unread === 1).length;
                console.log('üîî [AUTO-UPDATE ADMIN] Mensajes sin leer:', unreadCount);
                
                // Actualizar badge en el men√∫
                const badge = document.getElementById('unreadBadgeMenuAdmin');
                if (badge) {
                    const previousCount = parseInt(badge.textContent) || 0;
                    
                    if (unreadCount > 0) {
                        badge.textContent = unreadCount;
                        badge.style.display = 'inline-block';
                        
                        // Si hay mensajes nuevos que antes no hab√≠a, mostrar notificaci√≥n
                        if (unreadCount > previousCount && previousCount >= 0) {
                            const newMessages = unreadCount - previousCount;
                            if (newMessages > 0) {
                                showNotification(`${newMessages} mensaje${newMessages > 1 ? 's' : ''} nuevo${newMessages > 1 ? 's' : ''} del cliente`, 'info');
                            }
                        }
                    } else {
                        badge.style.display = 'none';
                    }
                }
                
                // Si estamos en la secci√≥n de tickets, recargar la tabla
                const ticketsSection = document.getElementById('tickets');
                if (ticketsSection && ticketsSection.style.display !== 'none') {
                    const tbody = document.getElementById('ticketsTable');
                    if (tbody) {
                        // Recargar tabla completa
                        loadTickets();
                    }
                }
                
                // üÜï Si hay un modal de ticket abierto, actualizarlo autom√°ticamente
                const modal = document.getElementById('ticketModal');
                if (modal && modal.style.display === 'flex' && currentOpenAdminTicketId) {
                    console.log(`üîÑ [AUTO-UPDATE ADMIN] Actualizando ticket abierto #${currentOpenAdminTicketId}`);
                    await refreshAdminOpenTicket(currentOpenAdminTicketId);
                }
                
            } catch (error) {
                console.error('‚ùå [AUTO-UPDATE ADMIN] Error actualizando badge:', error);
            }
        }

        // üÜï Funci√≥n para actualizar el ticket abierto en el modal admin (sin marcarlo como le√≠do)
        async function refreshAdminOpenTicket(ticketId) {
            try {
                // NO marcar como le√≠do, solo obtener los datos
                const response = await fetch(`${API_URL}/api/tickets/${ticketId}`);
                if (!response.ok) throw new Error('Error al obtener ticket');
                
                const ticket = await response.json();
                
                // Recargar completamente el contenido del modal (sin marcar como le√≠do)
                const detailsDiv = document.getElementById('ticketDetails');
                if (!detailsDiv) return;
                
                const priorityColors = {
                    'alta': 'danger',
                    'media': 'warning',
                    'baja': 'info'
                };
                
                const statusColors = {
                    'abierto': 'warning',
                    'en_proceso': 'info',
                    'cerrado': 'success'
                };
                
                const statusText = {
                    'abierto': 'Abierto',
                    'en_proceso': 'En Proceso',
                    'cerrado': 'Cerrado'
                };
                
                // Actualizar solo la parte que puede cambiar (respuestas del cliente)
                // Primero verificar si hay una nueva respuesta del cliente
                const clientResponseDiv = detailsDiv.querySelector('[data-client-response]');
                const hasNewClientResponse = ticket.client_response && (!clientResponseDiv || clientResponseDiv.getAttribute('data-timestamp') !== ticket.client_response_at);
                
                if (hasNewClientResponse || ticket.admin_response) {
                    // Solo actualizar si hay cambios en las respuestas
                    // Buscar y actualizar la secci√≥n de respuesta del cliente
                    if (ticket.client_response) {
                        const clientResponseHTML = `
                            <div style="border: 2px solid #0046FE; background: #e8f4ff; border-radius: 10px; padding: 15px; margin-bottom: 15px;" data-client-response data-timestamp="${ticket.client_response_at || ''}">
                                <h4 style="color: #0046FE; margin: 0 0 10px 0; font-size: 1rem;">üí¨ Respuesta del Cliente</h4>
                                <p style="margin: 0; font-size: 0.9rem; line-height: 1.6; white-space: pre-wrap;">${ticket.client_response}</p>
                                ${ticket.client_response_at ? `<p style="margin: 10px 0 0 0; font-size: 0.8rem; color: #666;">üìÖ Enviado: ${formatDate(ticket.client_response_at)}</p>` : ''}
                            </div>
                        `;
                        
                        // Si no existe, agregar despu√©s de la respuesta del admin
                        if (!clientResponseDiv) {
                            const adminResponseDiv = detailsDiv.querySelector('[data-admin-response]');
                            if (adminResponseDiv) {
                                adminResponseDiv.insertAdjacentHTML('afterend', clientResponseHTML);
                                console.log('‚úÖ [AUTO-UPDATE ADMIN] Nueva respuesta del cliente agregada');
                            }
                        }
                    }
                }
                
                console.log('‚úÖ [AUTO-UPDATE ADMIN] Ticket actualizado en modal');
                
            } catch (error) {
                console.error('‚ùå [AUTO-UPDATE ADMIN] Error al actualizar ticket:', error);
            }
        }

        // Iniciar actualizaci√≥n autom√°tica cada 10 segundos
        console.log('‚è∞ [AUTO-UPDATE ADMIN] Iniciando actualizaci√≥n autom√°tica cada 10 segundos');
        
        // Primera actualizaci√≥n inmediata
        updateAdminUnreadBadge();
        
        // Actualizaciones peri√≥dicas cada 10 segundos
        autoUpdateIntervalAdmin = setInterval(updateAdminUnreadBadge, 10000); // 10 segundos

        // ===== FORMATEADORES =====
        function formatPlan(plan) {
            const names = {
                'basico': 'B√°sico',
                'avanzado': 'Avanzado',
                'premium': 'Premium'
            };
            return names[plan] || plan;
        }

        function formatStatus(status) {
            const names = {
                'paid': 'Pagado',
                'pending': 'Pendiente'
            };
            return names[status] || status;
        }

        function formatDate(date) {
            if (!date) return 'N/A';
            return new Date(date).toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        // ===== SISTEMA DE NOTIFICACIONES =====
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('customNotification');
            const icon = document.getElementById('notificationIcon');
            const text = document.getElementById('notificationText');
            const progressBar = document.getElementById('notificationProgress');
            
            // Iconos y colores seg√∫n tipo
            const config = {
                success: { icon: '‚úÖ', color: '#009A62', bg: '#f0f9f4', border: '#009A62' },
                error: { icon: '‚ùå', color: '#dc3545', bg: '#ffe6e6', border: '#dc3545' },
                info: { icon: '‚ÑπÔ∏è', color: '#0046FE', bg: '#e8f4ff', border: '#0046FE' },
                warning: { icon: '‚ö†Ô∏è', color: '#ffc107', bg: '#fff3cd', border: '#ffc107' }
            };
            
            const style = config[type] || config.info;
            
            icon.textContent = style.icon;
            text.textContent = message;
            notification.style.borderColor = style.border;
            notification.style.background = style.bg;
            notification.style.color = style.color;
            progressBar.style.background = style.color;
            
            // Mostrar notificaci√≥n
            notification.classList.add('show');
            progressBar.style.animation = 'none';
            setTimeout(() => {
                progressBar.style.animation = 'progress 3s linear';
            }, 10);
            
            // Ocultar despu√©s de 3 segundos
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        async function showConfirmation(message) {
            return new Promise((resolve) => {
                const modal = document.getElementById('customConfirmModal');
                const messageEl = document.getElementById('confirmMessage');
                const confirmBtn = document.getElementById('confirmYes');
                const cancelBtn = document.getElementById('confirmNo');
                
                messageEl.textContent = message;
                modal.style.display = 'flex';
                
                confirmBtn.onclick = () => {
                    modal.style.display = 'none';
                    resolve(true);
                };
                
                cancelBtn.onclick = () => {
                    modal.style.display = 'none';
                    resolve(false);
                };
            });
        }
    </script>

    <!-- Sistema de Notificaciones -->
    <div id="customNotification" class="custom-notification">
        <div style="display: flex; align-items: center; gap: 12px;">
            <span id="notificationIcon" style="font-size: 1.5rem;"></span>
            <span id="notificationText" style="font-weight: 600; flex: 1;"></span>
            <button onclick="document.getElementById('customNotification').classList.remove('show')" style="background: none; border: none; font-size: 1.2rem; cursor: pointer; opacity: 0.6; color: inherit;">√ó</button>
        </div>
        <div id="notificationProgress" class="notification-progress"></div>
    </div>

    <!-- Modal de Confirmaci√≥n -->
    <div id="customConfirmModal" class="custom-confirm-modal">
        <div class="custom-confirm-content">
            <div style="font-size: 3rem; text-align: center; margin-bottom: 20px;">üöÄ</div>
            <p id="confirmMessage" style="font-size: 1.1rem; color: #1B1B1B; text-align: center; margin-bottom: 30px; line-height: 1.6;"></p>
            <div style="display: flex; gap: 15px;">
                <button id="confirmNo" class="btn-secondary" style="flex: 1; padding: 12px; border: 2px solid #e0e0e0; background: white; color: #666; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer;">
                    Cancelar
                </button>
                <button id="confirmYes" style="flex: 1; padding: 12px; background: #0046FE; color: white; border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer;">
                    Confirmar
                </button>
            </div>
        </div>
    </div>

    <style>
        .custom-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border: 2px solid;
            border-radius: 12px;
            padding: 16px 20px;
            min-width: 300px;
            max-width: 500px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            transform: translateX(calc(100% + 40px));
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 100000;
            overflow: hidden;
        }

        .custom-notification.show {
            transform: translateX(0);
        }

        .notification-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 4px;
            width: 100%;
            transform-origin: left;
        }

        @keyframes progress {
            from { transform: scaleX(1); }
            to { transform: scaleX(0); }
        }

        .custom-confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 100001;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .custom-confirm-content {
            background: white;
            padding: 40px 30px;
            border-radius: 20px;
            max-width: 450px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalZoom 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes modalZoom {
            from {
                transform: scale(0.7);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>

    <!-- Modal para Gesti√≥n de Web -->
    <div id="webManagementModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 id="webManagementTitle">‚öôÔ∏è Gestionar Web</h2>
                <button class="close-modal" onclick="closeWebManagementModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="webManagementForm" onsubmit="saveWebManagement(event)">
                    <input type="hidden" id="webManagementClientId">
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                            üìù Cliente / Empresa
                        </label>
                        <p id="webManagementInfo" style="padding: 10px; background: #f8f9fa; border-radius: 8px; margin: 0; color: #666;">
                            -
                        </p>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                            üåê URL del Sitio Web
                        </label>
                        <p id="webManagementWebsite" style="padding: 10px; background: #f8f9fa; border-radius: 8px; margin: 0;">
                            <a href="#" target="_blank" style="color: #0046FE; text-decoration: none;">-</a>
                        </p>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="wordpressUrlInput" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                            ‚úèÔ∏è URL de WordPress (Admin)
                        </label>
                        <input 
                            type="url" 
                            id="wordpressUrlInput" 
                            placeholder="https://tusitio.com/wp-admin" 
                            style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem;"
                        >
                        <small style="color: #666; font-size: 0.85rem; margin-top: 5px; display: block;">
                            El cliente usar√° este link para acceder a su WordPress
                        </small>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="screenshotUrlInput" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                            üì∏ URL de Captura de Pantalla
                        </label>
                        <input 
                            type="url" 
                            id="screenshotUrlInput" 
                            placeholder="https://ejemplo.com/screenshot.jpg" 
                            style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem;"
                        >
                        <small style="color: #666; font-size: 0.85rem; margin-top: 5px; display: block;">
                            Opcional: URL de una imagen de captura del sitio web
                        </small>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 30px;">
                        <button type="button" onclick="closeWebManagementModal()" style="padding: 12px 24px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            Cancelar
                        </button>
                        <button type="submit" style="padding: 12px 24px; background: #0046FE; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            üíæ Guardar Cambios
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

</body>
</html>
